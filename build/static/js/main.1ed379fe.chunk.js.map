{"version":3,"sources":["registerServiceWorker.js","index.js","utils/PushManager.js","api/subscription.js","reducers/user.js","utils/token.js","reducers/chats.js","reducers/messages.js","api/rest.js","api/chats.js","utils/WS.js","utils/date.js","reducers/chat.js","api/users.js","reducers/users.js","Components/UI/Btn/Btn.scss","Components/UI/Btn/Btn.js","Components/Modal/Modal.scss","utils/history.js","utils/helpers.js","Wrapper.js","Loading.js","reducers/outer.js","reducers/sagas.js","reducers/store.js","Components/Modal/Modal.js","utils/loginPopup.js","Components/Auth/Auth.js","Containers/Auth.js","Containers/Home.js","Containers/Terms.js","App.js","reducers/index.js","Components/Auth/Auth.scss"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","ReactDOM","render","react_default","a","createElement","App","document","getElementById","URL","process","origin","addEventListener","concat","fetch","response","status","headers","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","subscriptionApi","Subscription","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","Rest","urlB64ToUint8Array","base64String","base64","repeat","length","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","PushManager","run","pushManager","getSubscription","subscription","hasSubscription","_context","t0","subscribe","userVisibleOnly","applicationServerKey","create","JSON","stringify","source","resp","_context2","t1","unsubscribe","single","userApplyAction","userSubscribe","watcher","$$initialState","loaded","USER_UPDATE","USER_APPLY","user","$$state","arguments","undefined","_ref","type","payload","objectSpread","userUpdate","createAction","userApply","_ref2","regenerator_default","wrap","prev","next","token","setToken","subscribeUser","sent","localStorage","setItem","data","id","fork","put","message","stop","_marked","_user","select","getUser","eventChannel","emitter","chan","WS","join","on","leave","take","chatsUpdate","close","finish","_marked2","_context3","takeLatest","getToken","_marked3","KEY","__webpack_exports__","getItem","jwt","cookie","removeToken","onChatsUpdate","chatsApi","Chats","CHATS_UPDATE","CHATS_RESET","CHATS_ADD","sort","map","c","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_2__","last","Date","last_message","inserted_at","b","chats","item","tmp","reduce","chat","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__","values","chatsReset","chatsAdd","_chats","_Users_user_work_chat_web_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","all","MESSAGES_UPDATE","MESSAGES_RESET","prepareMessages","messages","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","sorted","shift","curr","res","in_block","sender_id","push","getMessages","messagesUpdate","messagesReset","url","_this","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__","getUrl","subpath","params","base_url","postQuery","putQuery","getQuery","deleteQuery","options","afterQuery","json","method","body","Authorization","Content-Type","mode","credentials","Error","ok","handleError","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","queryString","_socket","_connections","guardian_token","Socket","connect","disconnect","name","channel","filter","getCurrentDateTime","date","tzoffset","getTimezoneOffset","toISOString","slice","onChatInit","chatSubscribe","onChatMessage","onChatLoad","onChatUnmount","loading","can_load","chatsAPI","CHAT_INIT","CHAT_LOAD","CHAT_RESET","CHAT_UPDATE","CHAT_UNMOUNT","CHAT_MESSAGE","chatSubscription","chatLoad","chatReset","chatUpdate","chatMessage","getChat","cancel","chatId","_ref3","_chat","trim","_chat2","msgs","_context4","_marked4","_context5","_marked5","_context6","_marked6","Users","full","users","string","arrayFormat","onUsersInit","onUsersPrivateChat","userApi","chatApi","USERS_UPDATE","USERS_RESET","USERS_PRIVATE_CHAT","usersReset","usersPrivateChat","u","_user2","is_private","module","exports","Btn","defaultScheme","active","inverted","blueScheme","greenScheme","orangeScheme","githubScheme","googleScheme","facebookScheme","_classnames","children","className","onClick","disabled","scheme","cName","classnames","style","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1___default","assign","defaultProps","Modal","wrapper","hasWindow","createHistory","Wrapper","store","history","es","esm","Loading","UPDATE_STATE","outer","reducer","action","updateState","rootSaga","routes","/chats","mark","/chats/:chatId","chatsChatId","sagas","chatWatcher","userWatcher","chatsWatcher","usersWatcher","unshift","router","sagaMiddleware","createSagaMiddleware","middleware","thunk","modalRoot","props","el","appendChild","removeChild","createPortal","renderWrapper","styles","PureComponent","loginPopup","provider","Promise","resolve","win","curWidth","offsetWidth","leftPos","screenLeft","topPos","screenTop","result","features","open","Auth","onClickFacebook","e","preventDefault","applyAuth","onClickGoogle","Modal_Modal_Modal","Auth_Auth_Auth","dispatch","HomeContainer","Redirect","to","TermsContainer","loadableFactory","loader","Loadable","Comp","default","__webpack_require__","bind","userStore","initialState","middle","require","routerMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","createStore","ext","combineReducers","connectRouter","createReducers","applyMiddleware","apply","toConsumableArray","persistState","filtered","keys","getState","st","key","prototype","hasOwnProperty","runSaga","asyncReducers","configureStore","__INITIAL_STATE__","Containers_Auth","Switch","Route","exact","path","component","Home","Terms","Component"],"mappings":"sJAUMA,EAAcC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2DAsCN,SAASC,EAAgBC,GACvBC,UAAUC,cACPC,SAASH,GACTI,KAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACtCD,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfT,UAAUC,cAAcS,WAK1BC,QAAQC,IAAI,6CAKZD,QAAQC,IAAI,2CAMrBC,MAAM,SAAAC,GACLH,QAAQG,MAAM,4CAA6CA,KCzEjEC,IAASC,OAAOC,EAAAC,EAAAC,cAACC,EAAA,EAAD,MAASC,SAASC,eAAe,SDclC,WACb,GAA6C,kBAAmBtB,UAAW,CAGzE,GADkB,IAAIuB,IAAIC,GAAwB9B,OAAOC,UAC3C8B,SAAW/B,OAAOC,SAAS8B,OAIvC,OAGF/B,OAAOgC,iBAAiB,OAAQ,WAC9B,IAAM3B,EAAK,GAAA4B,OAAMH,GAAN,sBAEPhC,GAiDV,SAAiCO,GAE/B6B,MAAM7B,GACHI,KAAK,SAAA0B,GAGkB,MAApBA,EAASC,SACuD,IAAhED,EAASE,QAAQC,IAAI,gBAAgBC,QAAQ,cAG7CjC,UAAUC,cAAciC,MAAM/B,KAAK,SAAAC,GACjCA,EAAa+B,aAAahC,KAAK,WAC7BT,OAAOC,SAASyC,aAKpBtC,EAAgBC,KAGnBc,MAAM,WACLF,QAAQC,IACN,mEArEAyB,CAAwBtC,GAIxBC,UAAUC,cAAciC,MAAM/B,KAAK,WACjCQ,QAAQC,IACN,+GAMJd,EAAgBC,MCzCxBuC,qICAMC,EAAkB,gBCCtB,SAAAC,IAAe,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAH,GAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAD,GAAAM,KAAAH,KACP,sDAFgCI,IDE1C,SAASC,EAAmBC,GAS1B,IARA,IACMC,GAAUD,EADA,IAAIE,QAAQ,EAAIF,EAAaG,OAAS,GAAK,IAExDC,QAAQ,MAAO,KACfA,QAAQ,KAAM,KAEXC,EAAU5D,OAAO6D,KAAKL,GACtBM,EAAc,IAAIC,WAAWH,EAAQF,QAElCM,EAAI,EAAGA,EAAIJ,EAAQF,SAAUM,EACpCF,EAAYE,GAAKJ,EAAQK,WAAWD,GAEtC,OAAOF,MAGYI,aAGnB,SAAAA,IAAenB,OAAAC,EAAA,EAAAD,CAAAE,KAAAiB,GACY,qBAAd5D,WAA+C,qBAAXN,QAA0B,kBAAmBM,WAAa,gBAAiBN,QACxHiD,KAAKkB,+LAMsB7D,UAAUC,cAAcC,SAAxB,GAAAyB,OAAoCH,GAApC,kCAA3BmB,KAAK1C,8BACsB0C,KAAK1C,cAAc6D,YAAYC,yBAApDC,SAENrB,KAAKsB,kBAAqC,OAAjBD,qDAEzBrD,QAAQG,MAAM,uBAAdoD,EAAAC,2QAKGxB,KAAK1C,wFAImB0C,KAAK1C,cAAc6D,YAAYM,UAAU,CAClEC,iBAAiB,EACjBC,qBAAsBtB,EAAmBxB,2GAFrCwC,2BAMezB,EAAgBgC,OAAO,CACxCP,aAAc,CACZA,aAAcQ,KAAKC,UAAUT,GAC7BU,OAAQ,uBAHNC,SAMNhC,KAAKsB,iBAAkB,oBAChBU,qCAEPhC,KAAKsB,iBAAkB,4DAGzBtD,QAAQC,IAAI,iCAAZgE,EAAAC,kRAKGlC,KAAK1C,+EAIiB0C,KAAK1C,cAAc6D,YAAYC,8BAApDC,iCAEJrB,KAAKsB,iBAAkB,oBAChBD,EAAac,gDAGf,8GA1DUlB,EACZmB,OAAS,IAAInB,6MEYZoB,cAgBAC,cA+BOC,GAtEXC,EAAiB,CACrBC,QAAQ,GAGGC,EAAc,cACrBC,EAAa,aAGJ,SAASC,IAAkD,IAA7CC,EAA6CC,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAnCN,EAAmCQ,EAAAF,UAAArC,OAAA,EAAAqC,UAAA,QAAAC,EAAjBE,EAAiBD,EAAjBC,KAAMC,EAAWF,EAAXE,QAC7D,OAAQD,GACN,KAAKP,EACH,OAAO5C,OAAAqD,EAAA,EAAArD,CAAA,GACF+C,EACAK,GAEP,QACE,OAAOL,GAIN,IAAMO,EAAaC,YAAaX,GAC1BY,EAAYD,YAAaV,GAEtC,SAAUN,EAAVkB,GAAA,IAAAL,EAAA7B,EAAA,OAAAmC,EAAAjF,EAAAkF,KAAA,SAAAlC,GAAA,cAAAA,EAAAmC,KAAAnC,EAAAoC,MAAA,OAIyB,OAJGT,EAA5BK,EAA4BL,QAA5B3B,EAAAmC,KAAA,EAEIE,IAAMC,SAASX,EAAQU,OAF3BrC,EAAAoC,KAAA,EAI+B1C,EAAYmB,OAAO0B,gBAJlD,OASI,OALMzC,EAJVE,EAAAwC,OAOMC,aAAaC,QAAQ,eAAgB5C,EAAa6C,KAAKC,IAP7D5C,EAAAoC,KAAA,EASUS,eAAK9B,GATf,OAUI,OAVJf,EAAAoC,KAAA,GAUUU,cAAIjB,EAAWF,IAVzB,QAAA3B,EAAAoC,KAAA,iBAAApC,EAAAmC,KAAA,GAAAnC,EAAAC,GAAAD,EAAA,SAYIvD,QAAQC,IAAI,kBAAmBsD,EAAAC,GAAE8C,SAZrC,yBAAA/C,EAAAgD,SAAAC,EAAAxE,KAAA,UAgBA,SAAUsC,IAAV,IAAAjB,EAAAoD,EAAAP,EAAA,OAAAV,EAAAjF,EAAAkF,KAAA,SAAAxB,GAAA,cAAAA,EAAAyB,KAAAzB,EAAA0B,MAAA,OAGiB,OAHjB1B,EAAAyB,KAAA,EAAAzB,EAAA0B,KAAA,EAGuBe,iBAAOC,GAH9B,OAGU/B,EAHVX,EAAA8B,KAII1C,EAAeuD,uBAAa,SAACC,GAC3B,IAAMC,EAAOC,IAAG3C,OAAO4C,KAAV,QAAAhG,OAAuB4D,EAAKuB,IAAM,IAG/C,OAFAW,EAAKG,GAAG,UAAWJ,GAEZ,WACLE,IAAG3C,OAAO8C,MAAMJ,MATxB,OAcmB,OAdnB7C,EAAA0B,KAAA,EAcyBwB,eAAK9D,GAd9B,OAeM,OADM6C,EAdZjC,EAAA8B,KAAA9B,EAAA0B,KAAA,GAeYU,cAAIe,YAAYlB,IAf5B,QAAAjC,EAAA0B,KAAA,gBAAA1B,EAAA0B,KAAA,iBAAA1B,EAAAyB,KAAA,GAAAzB,EAAAT,GAAAS,EAAA,SAmBIjE,QAAQC,IAAI,gBAAiBgE,EAAAT,GAAE8C,SAnBnC,eAAArC,EAAAyB,KAAA,GAqBQrC,EAAagE,OACfhE,EAAagE,QAtBnBpD,EAAAqD,OAAA,6BAAArD,EAAAsC,SAAAgB,EAAAvF,KAAA,gBA2BO,SAAS2E,EAAQ7G,GACtB,OAAOA,EAAM8E,KAGR,SAAUL,IAAV,OAAAiB,EAAAjF,EAAAkF,KAAA,SAAA+B,GAAA,cAAAA,EAAA9B,KAAA8B,EAAA7B,MAAA,OACL,OADK6B,EAAA7B,KAAA,EACCS,eAAKqB,aAAY9C,EAAYN,GAD9B,WAGDuB,IAAM8B,WAHL,CAAAF,EAAA7B,KAAA,QAIH,OAJG6B,EAAA7B,KAAA,EAIGS,eAAK9B,GAJR,wBAAAkD,EAAAjB,SAAAoB,EAAA3F,wCC9EP,IAAM4F,EAAM,WAEGC,EAAA,GACbH,SADa,WAEX,MAA+B,qBAAjB1B,cAAgCA,aAAa8B,QAAQF,IAErE/B,SAJa,SAIJkC,GACHA,IACF/B,aAAaC,QAAQ2B,EAAKG,GAC1BrH,SAASsH,OAAT,wBAAAhH,OAA0C+G,KAG9CE,YAVa,WAWXjC,aAAaC,QAAQ2B,EAAK,MAC1BlH,SAASsH,OAAS,kQCiCZE,cAcO3D,GAxDX4D,EAAW,IAAIC,IAEf5D,EAAiB,GAEjB6D,EAAe,eACfC,EAAc,cACdC,EAAY,YAUlB,SAASC,EAAK3D,GACZ,OAAOA,EACJ4D,IAAI,SAAAC,GAAC,OAAA5G,OAAA6G,EAAA,EAAA7G,CAAA,GACD4G,EADC,CAEJE,KAAMF,EAAEE,MAAQ,IAAIC,KAAMH,EAAEI,cAAgBJ,EAAEI,aAAaC,aAAgB,IAAIF,KAAKH,EAAEK,kBAEvFP,KAAK,SAACjI,EAAGyI,GAAJ,OAAUA,EAAEJ,KAAOrI,EAAEqI,OAGhB,SAASK,IAAmD,IAA7CpE,EAA6CC,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAnCN,EAAmCQ,EAAAF,UAAArC,OAAA,EAAAqC,UAAA,QAAAC,EAAjBE,EAAiBD,EAAjBC,KAAMC,EAAWF,EAAXE,QAC9D,OAAQD,GACN,KAAKoD,EACH,OApBN,SAAiBxD,EAASqE,GACxB,IAAMC,EAAMtE,EAAQuE,OAAO,SAACtJ,EAAOuJ,GAAR,OAAAvH,OAAA6G,EAAA,EAAA7G,CAAA,GAAuBhC,EAAvBgC,OAAAwH,EAAA,EAAAxH,CAAA,GAA+BuH,EAAKlD,GAAKkD,KAAS,IAI7E,OAFAF,EAAID,EAAK/C,IAAM+C,EAERV,EAAK1G,OAAOyH,OAAOJ,IAefzG,CAAQmC,EAASK,GAC1B,KAAKoD,EACH,OAAOE,EAAKtD,GACd,KAAKqD,EACH,OAAOC,EAAK3D,EAAQ7D,OAAOkE,IAC7B,QACE,OAAOL,GAIN,IAAM2E,EAAanE,YAAaiD,GAC1BmB,EAAWpE,YAAakD,GACxBnB,EAAc/B,YAAagD,GAExC,SAAUH,IAAV,IAAA3C,EAAAmE,EAAA,OAAAC,EAAApJ,EAAAkF,KAAA,SAAAlC,GAAA,cAAAA,EAAAmC,KAAAnC,EAAAoC,MAAA,OAEsB,OAFtBpC,EAAAmC,KAAA,EAAAnC,EAAAoC,KAAA,EAE4Be,iBAAOC,KAFnC,UAAApB,EAAAhC,EAAAwC,MAAAR,EAEYK,MAFZ,CAAArC,EAAAoC,KAAA,SAIoB,OAJpBpC,EAAAoC,KAAA,EAI0BwC,EAASyB,MAJnC,OAKM,OADMX,EAJZ1F,EAAAwC,KAAAxC,EAAAoC,KAAA,GAKYU,cAAImD,EAAWP,EAAM/C,OALjC,QAAA3C,EAAAoC,KAAA,iBAOM,OAPNpC,EAAAoC,KAAA,GAOYU,cAAImD,EAAW,KAP3B,QAAAjG,EAAAoC,KAAA,iBAAApC,EAAAmC,KAAA,GAAAnC,EAAAC,GAAAD,EAAA,SAUIvD,QAAQC,IAAI,OAAQsD,EAAAC,GAAE8C,SAV1B,yBAAA/C,EAAAgD,SAAAC,EAAAxE,KAAA,UAcO,SAAUuC,IAAV,OAAAoF,EAAApJ,EAAAkF,KAAA,SAAAxB,GAAA,cAAAA,EAAAyB,KAAAzB,EAAA0B,MAAA,OACL,OADK1B,EAAA0B,KAAA,EACCS,eAAK8B,GADN,OAEL,OAFKjE,EAAA0B,KAAA,EAECS,eAAKqB,aAAY/C,IAAawD,GAF/B,wBAAAjE,EAAAsC,SAAAgB,EAAAvF,4LC3DDwC,EAAiB,GAEjBqF,EAAkB,kBAClBC,EAAiB,iBAEvB,SAASC,EAAgBlF,EAASK,GAChC,GAAuB,IAAnBA,EAAQzC,OACV,OAAOoC,EAcT,IAXA,IAAMmF,EAAW9E,EAAQuD,IAAI,SAAAnC,GAAO,OAAAxE,OAAAmI,EAAA,EAAAnI,CAAA,GAC/BwE,EAD+B,CAElCyC,YAAa,IAAIF,KAAKvC,EAAQyC,iBAE1BmB,EAASrF,EAAQ7D,OAAOgJ,GAAUxB,KAAK,SAACjI,EAAGyI,GAAJ,OAAUzI,EAAEwI,YAAcC,EAAED,cAErErD,EAAOwE,EAAOC,QACdC,EAAOF,EAAOC,QAEZE,EAAM,CAAC3E,GAENwE,EAAOzH,QACZ2H,EAAKE,SAAW5E,EAAK6E,YAAcH,EAAKG,UACxCF,EAAIG,KAAKJ,GACT1E,EAAO0E,EACPA,EAAOF,EAAOC,QAKhB,OAHMC,GACJC,EAAIG,KAAKJ,GAEJC,EAGM,SAASL,IAAsD,IAA7CnF,EAA6CC,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAnCN,EAAmCQ,EAAAF,UAAArC,OAAA,EAAAqC,UAAA,QAAAC,EAAjBE,EAAiBD,EAAjBC,KAAMC,EAAWF,EAAXE,QACjE,OAAQD,GACN,KAAK6E,EACH,OAAOC,EAAgBvF,EAAgBU,GAEzC,KAAK2E,EACH,OAAOE,EAAgBlF,EAASK,GAElC,QACE,OAAOL,GAIN,IAAM4F,EAAc,SAAA3K,GAAK,OAAIA,EAAMkK,UAE7BU,EAAiBrF,YAAawE,GAC9Bc,EAAgBtF,YAAayE,8HCjDrB1H,aAGnB,SAAAA,EAAYwI,GAAK,IAAAC,EAAA7I,KAAAF,OAAAgJ,EAAA,EAAAhJ,CAAAE,KAAAI,GAAAJ,KAFjB4I,IAAM/J,YAEWmB,KAIjB+I,OAAS,WAAiC,IAAhCC,EAAgClG,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAtB,GAAImG,EAAkBnG,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAT,KAC/B,OAAKmG,EAIL,GAAAjK,OAAU6J,EAAKD,IAAf,KAAA5J,OAAsB6J,EAAKK,UAA3BlK,OAAsCgK,EAAtC,KAAAhK,OAAiDiK,GAH/C,GAAAjK,OAAU6J,EAAKD,IAAf,KAAA5J,OAAsB6J,EAAKK,UAA3BlK,OAAsCgK,IALxChJ,KAAKkJ,SAAWN,qDAWX1E,GACL,OAAOlE,KAAKmJ,UAAL,GAAAnK,OAAkBgB,KAAK+I,UAAY7E,kCAGrCC,EAAID,GACT,OAAOlE,KAAKoJ,SAAL,GAAApK,OAAiBgB,KAAK+I,SAAtB,KAAA/J,OAAkCmF,GAAMD,iCAG3CC,GACJ,OAAOnE,KAAKqJ,SAAL,GAAArK,OAAiBgB,KAAK+I,SAAtB,KAAA/J,OAAkCmF,kCAIzC,OAAOnE,KAAKqJ,SAAL,GAAArK,OAAiBgB,KAAK+I,0CAGxB5E,GACL,OAAOnE,KAAKsJ,YAAL,GAAAtK,OAAoBgB,KAAK+I,SAAzB,KAAA/J,OAAqCmF,6EAG/ByE,oFACP7C,EAAMnC,IAAM8B,oBACCzG,MAAM2J,EAAK5I,KAAKuJ,QAAQxD,kBAArC/D,SACA9C,EAAWkB,EAAKoJ,WAAWxH,qBAC1B9C,EAASuK,qLAGFb,EAAK1E,oFACb6B,EAAMnC,IAAM8B,oBAECzG,MAAM2J,EAAK5I,KAAKuJ,QAAQxD,EAAK,CAC9C2D,OAAQ,OACRC,KAAM9H,KAAKC,UAAUoC,oBAFjBlC,SAIA9C,EAAWkB,EAAKoJ,WAAWxH,qBAC1B9C,EAASuK,sLAGHb,EAAK1E,oFACZ6B,EAAMnC,IAAM8B,oBAECzG,MAAM2J,EAAK5I,KAAKuJ,QAAQxD,EAAK,CAC9C2D,OAAQ,MACRC,KAAM9H,KAAKC,UAAUoC,oBAFjBlC,SAIA9C,EAAWkB,EAAKoJ,WAAWxH,qBAC1B9C,EAASuK,yLAGAb,kFACV7C,EAAMnC,IAAM8B,oBAECzG,MAAM2J,EAAK5I,KAAKuJ,QAAQxD,EAAK,CAC9C2D,OAAQ,0BADJ1H,SAGW5B,EAAKoJ,WAAWxH,sBAC1B,sIAgBD4B,GAAoB,IAAbqF,EAAanG,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAJ,GAChB1D,EAAU,CACdwK,cAAa,UAAA5K,OAAY4E,GACzBiG,eAAgB,oBAGlB,OAAO/J,OAAAmI,EAAA,EAAAnI,CAAA,CACLV,UACA0K,KAAM,OACNC,YAAa,WACVd,iFAvBkB/J,yFACJA,EAASuK,oBAAtBzH,SACA,IAAIgI,MAAMhI,EAAKsC,+IAGLpF,GAChB,OAAKA,EAAS+K,GAIP/K,EAHEkB,EAAK8J,YAAYhL,gJCjFTkH,cACnB,SAAAA,IAAe,OAAAtG,OAAAqK,EAAA,EAAArK,CAAAE,KAAAoG,GAAAtG,OAAAsK,EAAA,EAAAtK,CAAAE,KAAAF,OAAAuK,EAAA,EAAAvK,CAAAsG,GAAAjG,KAAAH,KACP,oFAGCmE,GAAyB,IAArB2C,EAAqBhE,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAN,KAC1B,OAAO9C,KAAKqJ,SAASrJ,KAAK+I,OAAL,IAAA/J,OAAgBmF,EAAhB,aAA+BmG,IAAYxI,UAAU,CAAEgF,mDAGtE3C,EAAIG,GACV,OAAOtE,KAAKmJ,UAAL,GAAAnK,OAAkBgB,KAAK+I,SAAvB,KAAA/J,OAAmCmF,EAAnC,YAAiD,CAAEG,QAAS,CAAEA,oBAVtClE,wGCAd2E,aAGnB,SAAAA,IAAejF,OAAAqK,EAAA,EAAArK,CAAAE,KAAA+E,GACb/E,KAAKuK,QAAU,KACfvK,KAAKwK,aAAe,yDAIpB,IAAKxK,KAAKuK,QAAS,CACjB,IAAME,EAAiB7G,IAAM8B,WAC7B1F,KAAKuK,QAAU,IAAIG,SAAJ,GAAA1L,OAAcH,YAAyB6B,QAAQ,QAAS,MAAxD,WAAwE,CACrFuI,OAAQ,CAAEwB,oBAIdzK,KAAKuK,QAAQI,+CAIT3K,KAAKuK,SACPvK,KAAKuK,QAAQK,0CAIZC,GAAmB,IAAb5B,EAAanG,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAJ,GACb9C,KAAKuK,SACRvK,KAAK2K,UAGP,IAAM7F,EAAO9E,KAAKuK,QAAQO,QAAQD,EAAM5B,GAKxC,OAJAnE,EAAKE,OAELhF,KAAKwK,aAAahC,KAAK1D,GAEhBA,gCAGHA,GACA9E,KAAKwK,aAAa/J,SACpBT,KAAKwK,aAAexK,KAAKwK,aAAaO,OAAO,SAAC3C,GAAD,OAAUA,IAAStD,IAE3D9E,KAAKwK,aAAa/J,QACrBT,KAAK4K,uBA3CQ7F,EACZ3C,OAAS,IAAI2C,8GCJf,SAASiG,EAAmBC,GACjC,IAAIC,EAAwC,IAA5BD,EAAME,oBAGtB,OAFoB,IAAItE,KAAKoE,EAAOC,GAAWE,cAAcC,MAAM,EAAG,IAAI3K,QAAQ,IAAK,gMCkDxE4K,cAePC,cA4BAC,cASAC,cAcAC,cAYOnJ,GAzHXC,EAAiB,CACrBC,QAAQ,EACRkJ,SAAS,EACTC,UAAU,GAGNC,EAAW,IAAIzF,IAER0F,EAAY,YACZC,EAAY,YACZC,EAAa,aACbC,EAAc,cACdC,EAAe,eACfC,EAAe,eAEb,SAAS9E,IAAkD,IAA7CxE,EAA6CC,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAnCN,EAAmCQ,EAAAF,UAAArC,OAAA,EAAAqC,UAAA,QAAAC,EAAjBE,EAAiBD,EAAjBC,KAAMC,EAAWF,EAAXE,QAC7D,OAAQD,GACN,KAAK+I,EACH,OAAOlM,OAAAqD,EAAA,EAAArD,CAAA,GACF0C,EACAU,GAEP,KAAK+I,EACH,OAAOnM,OAAAqD,EAAA,EAAArD,CAAA,GACF+C,EACAK,GAEP,QACE,OAAOL,GAIWQ,YAAayI,GAA9B,IASHM,EARSC,EAAWhJ,YAAa0I,GACxBO,EAAYjJ,YAAa2I,GACzBO,EAAalJ,YAAa4I,GAE1BO,GADcnJ,YAAa6I,GACb7I,YAAa8I,IAE3BM,EAAU,SAAA3O,GAAK,OAAIA,EAAMuJ,MAI/B,SAAUiE,EAAV/H,GAAA,IAAAL,EAAAlB,EAAA,OAAAwB,EAAAjF,EAAAkF,KAAA,SAAAlC,GAAA,cAAAA,EAAAmC,KAAAnC,EAAAoC,MAAA,UAAuBT,EAAvBK,EAAuBL,QAAvB3B,EAAAmC,KAAA,GAEC0I,EAFD,CAAA7K,EAAAoC,KAAA,QAGD,OAHCpC,EAAAoC,KAAA,EAGK+I,iBAAON,GAHZ,OAKU,OALV7K,EAAAoC,KAAA,EAKgBkI,EAAS5M,MAAMiE,GAL/B,OAMH,OADMlB,EALHT,EAAAwC,KAAAxC,EAAAoC,KAAA,GAMGU,cAAIkI,EAAWzM,OAAAqD,EAAA,EAAArD,CAAA,GAAKkC,EAAKkC,KAAX,CAAiB0H,SAAwC,KAA9B5J,EAAKkC,KAAK8D,SAASvH,WAN/D,QAOH,OAPGc,EAAAoC,KAAA,GAOGU,cAAIsE,YAAc3G,EAAKkC,KAAK8D,WAP/B,QAQgB,OARhBzG,EAAAoC,KAAA,GAQsBS,eAAKmH,EAAevJ,EAAKkC,KAAKC,IARpD,QAQHiI,EARG7K,EAAAwC,KAAAxC,EAAAoC,KAAA,iBAAApC,EAAAmC,KAAA,GAAAnC,EAAAC,GAAAD,EAAA,SAUHvD,QAAQC,IAAI,aAAcsD,EAAAC,GAAE8C,SAVzB,yBAAA/C,EAAAgD,SAAAC,EAAAxE,KAAA,UAeP,SAAUuL,EAAcoB,GAAxB,IAAAtL,EAAA6C,EAAA,OAAAV,EAAAjF,EAAAkF,KAAA,SAAAxB,GAAA,cAAAA,EAAAyB,KAAAzB,EAAA0B,MAAA,OAAA1B,EAAAyB,KAAA,EAIIrC,EAAeuD,uBAAa,SAACC,GAC3B,IAAMC,EAAOC,IAAG3C,OAAO4C,KAAV,QAAAhG,OAAuB2N,GAAU,IAG9C,OAFA7H,EAAKG,GAAG,aAAcJ,GAEf,WACLE,IAAG3C,OAAO8C,MAAMJ,MATxB,OAcmB,OAdnB7C,EAAA0B,KAAA,EAcyBwB,eAAK9D,GAd9B,OAeM,OADM6C,EAdZjC,EAAA8B,KAAA9B,EAAA0B,KAAA,EAeYU,cAAIqE,YAAe,CAACxE,KAfhC,OAgBM,OAhBNjC,EAAA0B,KAAA,GAgBYU,cAAIkI,EAAW,CAAEzF,aAAc5C,KAhB3C,QAAAjC,EAAA0B,KAAA,gBAAA1B,EAAA0B,KAAA,iBAAA1B,EAAAyB,KAAA,GAAAzB,EAAAT,GAAAS,EAAA,SAoBIjE,QAAQC,IAAI,gBAAiBgE,EAAAT,GAAE8C,SApBnC,eAAArC,EAAAyB,KAAA,GAsBQrC,EAAagE,OACfhE,EAAagE,QAvBnBpD,EAAAqD,OAAA,6BAAArD,EAAAsC,SAAAgB,EAAAvF,KAAA,gBA4BA,SAAUwL,EAAVoB,GAAA,IAAA1J,EAAA2J,EAAA,OAAArJ,EAAAjF,EAAAkF,KAAA,SAAA+B,GAAA,cAAAA,EAAA9B,KAAA8B,EAAA7B,MAAA,OAEiB,OAFST,EAA1B0J,EAA0B1J,QAA1BsC,EAAA9B,KAAA,EAAA8B,EAAA7B,KAAA,EAEuBe,iBAAO+H,GAF9B,OAGI,OADMpF,EAFV7B,EAAAzB,KAAAyB,EAAA7B,KAAA,EAGUkI,EAASvH,QAAQ+C,EAAKlD,GAAIjB,EAAQ4J,QAH5C,OAAAtH,EAAA7B,KAAA,gBAAA6B,EAAA9B,KAAA,EAAA8B,EAAAhE,GAAAgE,EAAA,SAKIxH,QAAQC,IAAI,gBAAiBuH,EAAAhE,GAAE8C,SALnC,yBAAAkB,EAAAjB,SAAAoB,EAAA3F,KAAA,SASA,SAAUyL,IAAV,IAAAsB,EAAAC,EAAApG,EAAAoB,EAAA,OAAAxE,EAAAjF,EAAAkF,KAAA,SAAAwJ,GAAA,cAAAA,EAAAvJ,KAAAuJ,EAAAtJ,MAAA,OAEI,OAFJsJ,EAAAvJ,KAAA,EAAAuJ,EAAAtJ,KAAA,EAEUU,cAAIkI,EAAW,CAAEZ,SAAS,KAFpC,OAGiB,OAHjBsB,EAAAtJ,KAAA,EAGuBe,iBAAO+H,GAH9B,OAIiB,OADPpF,EAHV4F,EAAAlJ,KAAAkJ,EAAAtJ,KAAA,EAIuBe,iBAAO+D,KAJ9B,OAMqB,OAFXuE,EAJVC,EAAAlJ,KAKU6C,EAAOoG,EAAK,GALtBC,EAAAtJ,KAAA,GAM2BkI,EAAS7D,SAASX,EAAKlD,GAAI6G,EAAmBpE,EAAKG,cAN9E,QAOI,OADMiB,EANViF,EAAAlJ,KAAAkJ,EAAAtJ,KAAA,GAOUU,cAAIkI,EAAW,CAAEZ,SAAS,EAAOC,SAAmC,KAAzB5D,EAAS9D,KAAKzD,OAAegC,QAAQ,KAP1F,QAQI,OARJwK,EAAAtJ,KAAA,GAQUU,cAAIqE,YAAeV,EAAS9D,OARtC,QAAA+I,EAAAtJ,KAAA,iBAAAsJ,EAAAvJ,KAAA,GAAAuJ,EAAAzL,GAAAyL,EAAA,SAUIjP,QAAQC,IAAI,aAAcgP,EAAAzL,GAAE8C,SAVhC,yBAAA2I,EAAA1I,SAAA2I,EAAAlN,KAAA,UAcA,SAAU0L,IAAV,OAAAlI,EAAAjF,EAAAkF,KAAA,SAAA0J,GAAA,cAAAA,EAAAzJ,KAAAyJ,EAAAxJ,MAAA,OAEI,OAFJwJ,EAAAzJ,KAAA,EAAAyJ,EAAAxJ,KAAA,EAEUU,cAAIiI,EAAU,KAFxB,OAGI,OAHJa,EAAAxJ,KAAA,EAGUU,cAAIsE,YAAc,KAH5B,WAIQyD,EAJR,CAAAe,EAAAxJ,KAAA,QAKM,OALNwJ,EAAAxJ,KAAA,EAKY+I,iBAAON,GALnB,OAAAe,EAAAxJ,KAAA,iBAAAwJ,EAAAzJ,KAAA,GAAAyJ,EAAA3L,GAAA2L,EAAA,SAQInP,QAAQC,IAAI,gBAAiBkP,EAAA3L,GAAE8C,SARnC,yBAAA6I,EAAA5I,SAAA6I,EAAApN,KAAA,UAYO,SAAUuC,IAAV,OAAAiB,EAAAjF,EAAAkF,KAAA,SAAA4J,GAAA,cAAAA,EAAA3J,KAAA2J,EAAA1J,MAAA,OACL,OADK0J,EAAA1J,KAAA,EACCS,eAAKqB,aAAYqG,EAAWR,GAD7B,OAEL,OAFK+B,EAAA1J,KAAA,EAECS,eAAKqB,aAAYsG,EAAWN,GAF7B,OAGL,OAHK4B,EAAA1J,KAAA,EAGCS,eAAKqB,aAAYyG,EAAcR,GAHhC,OAIL,OAJK2B,EAAA1J,KAAA,EAICS,eAAKqB,aAAY0G,EAAcX,GAJhC,wBAAA6B,EAAA9I,SAAA+I,EAAAtN,kJC/HcuN,cACnB,SAAAA,IAAe,OAAAzN,OAAAC,EAAA,EAAAD,CAAAE,KAAAuN,GAAAzN,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAyN,GAAApN,KAAAH,KACP,kFAGDkE,GACL,OAAOlE,KAAKmJ,UAAUnJ,KAAK+I,SAAU7E,mCAGnB,IAAdsJ,EAAc1K,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,IAAAA,UAAA,GAClB,OAAO9C,KAAKqJ,SAASrJ,KAAK+I,OAAO,GAAIuB,IAAYxI,UAAU,CAAE0L,0CAG9C,IAAZC,EAAY3K,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAJ,GACL4K,EAASpD,IAAYxI,UAAU,CAAE2L,SAAS,CAAEE,YAAa,YAC/D,OAAO3N,KAAKqJ,SAASrJ,KAAK+I,OAAO,QAAS2E,iBAfXtN,0KCgClBwN,cAWPC,cAcOtL,GAnDXuL,EAAU,IAAIP,EACdQ,EAAU,IAAI3H,IACd5D,EAAiB,GAEVwL,EAAe,eAEfC,EAAc,cACdC,EAAqB,qBAGnB,SAAStL,IAAkD,IAA7CC,EAA6CC,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAnCN,EAAmCQ,EAAAF,UAAArC,OAAA,EAAAqC,UAAA,QAAAC,EAAjBE,EAAiBD,EAAjBC,KAAMC,EAAWF,EAAXE,QAC7D,OAAQD,GACN,KAAKgL,EACH,OAAO/K,EACT,KAAK8K,EACH,OAAOnL,EAAQ7D,OAAOkE,GACxB,QACE,OAAOL,GAIcQ,YAAa2K,GAAjC,IACMG,EAAa9K,YAAa4K,GAE1BG,GADa/K,YAlBC,eAmBKA,YAAa6K,IAEtC,SAAUN,IAAV,IAAAnJ,EAAAgJ,EAAAvJ,EAAA,OAAAV,EAAAjF,EAAAkF,KAAA,SAAAlC,GAAA,cAAAA,EAAAmC,KAAAnC,EAAAoC,MAAA,OAEU,OAFVpC,EAAAmC,KAAA,EAAAnC,EAAAoC,KAAA,EAEgBe,iBAAOC,KAFvB,OAGW,OADR/B,EAFHrB,EAAAwC,KAAAxC,EAAAoC,KAAA,EAGiBmK,EAAQlG,MAHzB,OAKH,OAFM6F,EAHHlM,EAAAwC,KAIGG,EAAOuJ,EAAMvJ,KAAK6G,OAAO,SAACsD,GAAD,OAAQA,EAAElK,KAAOvB,EAAKuB,KAJlD5C,EAAAoC,KAAA,GAKGU,cAAI8J,EAAWjK,IALlB,QAAA3C,EAAAoC,KAAA,iBAAApC,EAAAmC,KAAA,GAAAnC,EAAAC,GAAAD,EAAA,SAOHvD,QAAQC,IAAI,cAAesD,EAAAC,GAAE8C,SAP1B,yBAAA/C,EAAAgD,SAAAC,EAAAxE,KAAA,UAWP,SAAU6N,EAAVtK,GAAA,IAAAL,EAAAoL,EAAAjH,EAAA,OAAA7D,EAAAjF,EAAAkF,KAAA,SAAAxB,GAAA,cAAAA,EAAAyB,KAAAzB,EAAA0B,MAAA,OAEiB,OAFcT,EAA/BK,EAA+BL,QAA/BjB,EAAAyB,KAAA,EAAAzB,EAAA0B,KAAA,EAEuBe,iBAAOC,KAF9B,OAGiB,OADP/B,EAFVX,EAAA8B,KAAA9B,EAAA0B,KAAA,EAGuBoK,EAAQnM,OAAO,CAAEyF,KAAM,CAAEwD,KAAM,UAAW0D,YAAY,EAAMd,MAAO,CAACvK,EAAQiB,GAAIvB,EAAKuB,OAH5G,OAII,OADMkD,EAHVpF,EAAA8B,KAAA9B,EAAA0B,KAAA,GAIUU,cAAImE,YAAI,UAAAxJ,OAAWqI,EAAKnD,KAAKC,MAJvC,QAKI,OALJlC,EAAA0B,KAAA,GAKUU,cAAIoD,YAAS3H,OAAAqD,EAAA,EAAArD,CAAA,GACduH,EAAKnD,KADQ,CAEhB0C,KAAM,IAAIC,SAPhB,QAAA5E,EAAA0B,KAAA,iBAAA1B,EAAAyB,KAAA,GAAAzB,EAAAT,GAAAS,EAAA,SAUIjE,QAAQC,IAAI,qBAAsBgE,EAAAT,GAAE8C,SAVxC,yBAAArC,EAAAsC,SAAAgB,EAAAvF,KAAA,UAcO,SAAUuC,IAAV,OAAAiB,EAAAjF,EAAAkF,KAAA,SAAA+B,GAAA,cAAAA,EAAA9B,KAAA8B,EAAA7B,MAAA,OACL,OADK6B,EAAA7B,KAAA,EACCS,eAAKqB,aAAYyI,EAAoBL,GADtC,wBAAArI,EAAAjB,SAAAoB,EAAA3F,2BChEPwO,EAAAC,QAAA,CAAkBC,IAAA,iBAAAC,cAAA,2BAAAC,OAAA,oBAAAC,SAAA,sBAAAC,WAAA,wBAAAC,YAAA,yBAAAC,aAAA,0BAAAC,aAAA,0BAAAC,aAAA,0BAAAC,eAAA,4JCSH,SAAST,EAAT1L,GAAyF,IAAAoM,EAA1EC,EAA0ErM,EAA1EqM,SAAUC,EAAgEtM,EAAhEsM,UAAWC,EAAqDvM,EAArDuM,QAAS1E,EAA4C7H,EAA5C6H,KAAM+D,EAAsC5L,EAAtC4L,OAAQC,EAA8B7L,EAA9B6L,SAAUW,EAAoBxM,EAApBwM,SAAUC,EAAUzM,EAAVyM,OACtFC,EAAQC,IAAWC,IAAMlB,IAAKkB,IAAK,GAAA5Q,OAAIyQ,EAAJ,WAAqBH,GAAtCF,EAAA,GAAAtP,OAAA+P,EAAA,EAAA/P,CAAAsP,EACrBQ,IAAMhB,OAASA,GADM9O,OAAA+P,EAAA,EAAA/P,CAAAsP,EAErBQ,IAAMf,SAAWA,GAFIO,IAIxB,OACEU,EAAAvR,EAAAC,cAAA,SAAAsB,OAAAiQ,OAAA,CAAQT,UAAWI,GAAW,CAAE7E,OAAM2E,WAAUD,YAAYF,GAmBhEX,EAAIsB,aAAe,CACjBP,OAAQ,UACR5E,KAAM,GACNyE,UAAW,GACXE,UAAU,EACVX,UAAU,EACVD,QAAQ,uBCxCVJ,EAAAC,QAAA,CAAkBwB,MAAA,qBAAAC,QAAA,8KCQHC,ECH4B,qBAAXpT,cDGJqT,KECb,SAASC,EAATrN,GAAsC,IAAnBsN,EAAmBtN,EAAnBsN,MAAOjB,EAAYrM,EAAZqM,SACvC,OAAIkB,EAEAjS,EAAAC,EAAAC,cAACgS,EAAA,EAAD,CAAUF,MAAOA,GACfhS,EAAAC,EAAAC,cAACiS,EAAA,gBAAD,CAAiBF,QAASA,GACvBlB,IAOP/Q,EAAAC,EAAAC,cAACgS,EAAA,EAAD,CAAUF,MAAOA,GACdjB,GChBP,IAIeqB,EAJC,kBACdpS,EAAAC,EAAAC,cAAA,uECAImS,EAAe,eAEN,SAASC,EAAMC,GAC5B,OAAO,SAAsB/S,EAAOgT,GAClC,OAAQA,EAAO7N,MACb,KAAK0N,EACH,OAAOE,EAAQ/Q,OAAAqD,EAAA,EAAArD,CAAA,GAAKhC,EAAUgT,EAAO5N,SAAW4N,GAClD,QACE,OAAOD,EAAQ/S,EAAOgT,KAKvB,IAAMC,EAAc1N,YAAasN,yFCGfK,GATnBC,EAAS,CACXC,SADW1N,EAAAjF,EAAA4S,KAAA,SAAAlK,IAAA,OAAAzD,EAAAjF,EAAAkF,KAAA,SAAAlC,GAAA,cAAAA,EAAAmC,KAAAnC,EAAAoC,MAAA,OAEX,OAFWpC,EAAAoC,KAAA,EAELxD,eAAKyN,KAFA,wBAAArM,EAAAgD,SAAA0C,EAAAjH,QAIXoR,iBAJW5N,EAAAjF,EAAA4S,KAAA,SAAAE,EAAArO,GAAA,IAAA2J,EAAA,OAAAnJ,EAAAjF,EAAAkF,KAAA,SAAAxB,GAAA,cAAAA,EAAAyB,KAAAzB,EAAA0B,MAAA,OAKX,OADmBgJ,EAJR3J,EAIQ2J,OAJR1K,EAAA0B,KAAA,EAKLxD,eAAKmL,IAAY,CAAEpI,QAASyJ,IALvB,wBAAA1K,EAAAsC,SAAA8M,EAAArR,SASA,SAAUgR,IAAV,IAAAM,EAAA,OAAA9N,EAAAjF,EAAAkF,KAAA,SAAA+B,GAAA,cAAAA,EAAA9B,KAAA8B,EAAA7B,MAAA,OAYb,OAXM2N,EAAQ,CACZC,cACAC,cACAC,cACAC,eAGEnB,GACFe,EAAMK,QAAQC,iBAAOrB,EAASU,IATnBzL,EAAA7B,KAAA,EAYPS,eAAKwD,MAAK0J,GAZH,wBAAA9L,EAAAjB,SAAAC,EAAAxE,2BCRT6R,EAAiBC,oBAGjBC,EAAa,CACjBC,IACAH,0DCXII,EAAYvT,SAASC,eAAe,SAErBsR,cACnB,SAAAA,EAAYiC,GAAO,IAAArJ,EAAA,OAAA/I,OAAAC,EAAA,EAAAD,CAAAE,KAAAiQ,IACjBpH,EAAA/I,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAmQ,GAAA9P,KAAAH,KAAMkS,KACDC,GAAKzT,SAASF,cAAc,OAFhBqK,mFAcjBoJ,EAAUG,YAAYpS,KAAKmS,mDAI3BF,EAAUI,YAAYrS,KAAKmS,qCAI3B,OAAO/T,IAASkU,aACdtS,KAAKuS,gBACLvS,KAAKmS,4CAKP,IAAMvC,EAAQD,IAAW6C,IAAOtC,QAASlQ,KAAKkS,MAAM5C,WACpD,OACEhR,EAAAC,EAAAC,cAAA,OAAK8Q,UAAWkD,IAAOvC,OACrB3R,EAAAC,EAAAC,cAAA,OAAK8Q,UAAWM,GACb5P,KAAKkS,MAAM7C,kBAlCaoD,4CCNpB,SAASC,GAAWC,GACjC,OAAO,IAAIC,QAAQ,SAACC,GAClB,IAAIC,EACEC,EAAWrU,SAASiL,KAAKqJ,YAEzBC,EADUlW,OAAOmW,WACIH,EAAW,EAAK,IAGrCI,EADSpW,OAAOqW,UACE,IASxBrW,OAAOgC,iBAAiB,UAPxB,SAAwBsU,GAClBA,EAAOnP,KAAKC,KACd0O,EAAQQ,EAAOnP,MACf4O,EAAIzN,WAI2C,GACnD,IAAMiO,EAAQ,mEAAAtU,OAAsEmU,EAAtE,UAAAnU,OAAqFiU,GACnGjV,QAAQC,IAAR,GAAAe,OAAeH,YAAf,UAAAG,OAAgD2T,IAChDG,EAAM/V,OAAOwW,KAAP,GAAAvU,OAAeH,YAAf,UAAAG,OAAgD2T,GAAY,aAAcW,SCd/DE,8MAcnBC,gBAAkB,SAACC,GACbA,GACFA,EAAEC,iBAEJjB,GAAW,YACRlV,KAAK,SAAC0G,GACL2E,EAAKqJ,MAAM0B,UAAU1P,KAEtBhG,MAAM,SAACC,GAENH,QAAQC,IAAIE,EAAMmG,cAIxBuP,cAAgB,SAACH,GACXA,GACFA,EAAEC,iBAGJjB,GAAW,UACRlV,KAAK,SAAC0G,GACL2E,EAAKqJ,MAAM0B,UAAU1P,KAEtBhG,MAAM,SAACC,GAENH,QAAQC,IAAIE,EAAMmG,oFArCtB,OACEhG,EAAAC,EAAAC,cAACsV,EAAD,CAAOxE,UAAWkD,KAAOgB,MACvBlV,EAAAC,EAAAC,cAACkQ,GAAA,EAAD,CAAKa,QAASvP,KAAKyT,gBAAiBhE,OAAO,YAA3C,uBAGAnR,EAAAC,EAAAC,cAACkQ,GAAA,EAAD,CAAKa,QAASvP,KAAK6T,cAAepE,OAAO,UAAzC,6BAP0BgD,iBCU5Be,oLAEF,OAAIxT,KAAKkS,MAAMtP,KAAKuB,GACX,KAIP7F,EAAAC,EAAAC,cAACuV,GAAD,CAAeH,UAAW5T,KAAKkS,MAAM0B,mBAPxBnB,iBAYJ9H,eAtBS,SAAA7M,GAAK,MAAK,CAChC8E,KAAM9E,EAAM8E,OAGY,SAAAoR,GAAQ,MAAK,CACrCJ,UADqC,SAC3B1P,GACR8P,EAAS1Q,YAAUY,OAgBRyG,CAA4C6I,cChB5CS,oLAPX,OACE3V,EAAAC,EAAAC,cAAC0V,GAAA,EAAD,CAAUC,GAAG,kBAHS1B,iBCQb2B,oLAPX,OACE9V,EAAAC,EAAAC,cAAA,wPAHuBiU,iBCGtB,SAAS4B,GAAgBC,GAC9B,OAAOC,IAAS,CACdD,SACA3I,QAAS+E,EACTrS,OAHc,SAGPoE,EAAQyP,GACb,IAAMsC,EAAO/R,EAAOgS,QACpB,OAAOnW,EAAAC,EAAAC,cAACgW,EAAStC,uCAKvB,IAAM9L,GAAQiO,GAAgB,kBAAMzB,QAAAhL,IAAA,CAAA8M,EAAAhB,EAAA,GAAAgB,EAAAhB,EAAA,KAAAlW,KAAAkX,EAAAC,KAAA,aAE9BC,GPcS,SAAwBC,GACrC,IAAMC,EAAM,GAAA9V,OAAO+S,GACnB,GAAIxB,EAAS,CACX,IAAMqB,EAASmD,EAAQ,IACvBD,EAAOtM,KAAKoJ,EAAOoD,iBAAiBzE,IAGtC,IAAM0E,EAAoBlY,QAAUA,OAAOmY,sCAAyCC,IAE9E7E,EAAQ8E,YQ9BD,SAAkB7E,GAAmB,IAAV8E,EAAUvS,UAAArC,OAAA,QAAAsC,IAAAD,UAAA,GAAAA,UAAA,GAAJ,GAC9C,OAAO8N,EAAM0E,YAAgBxV,OAAAqD,EAAA,EAAArD,CAAA,CAAE8R,OAAQ2D,wBAAchF,GAAU3N,SAAMyE,SAAMJ,UAAOwG,UAAOmD,QAAO5I,cAAaqN,KR8B3GG,CAAejF,GACf,GACA0E,EAAiBQ,IAAeC,WAAf,EAAA5V,OAAA6V,EAAA,EAAA7V,CAAmBgV,IAASc,IAAa,CAAC,WAiC7D,OA9BAtF,EAAMS,YAAc,SAACjT,GACnB,IACM+X,EADO/V,OAAOgW,KAAKxF,EAAMyF,YACT3O,OAAO,SAAC4O,EAAIC,GAIhC,OAHInW,OAAOoW,UAAUC,eAAehW,KAAKrC,EAAOmY,KAC9CD,EAAGC,GAAOnY,EAAMmY,IAEXD,GACN,IAEH,OAAO1F,EAAM0D,SAASjD,EAAY8E,KAEpCvF,EAAM8F,QAAUvE,EAAe3Q,IAC/BoP,EAAM+F,cAAgB,GAEtB/F,EAAMS,YAAY8D,GAclBhD,EAAe3Q,IAAIoQ,GAEZhB,EO3DSgG,CAAevZ,OAAOwZ,mBAAqB,IAEvD9X,oLAEF,OACEH,EAAAC,EAAAC,cAAC6R,EAAD,CAASC,MAAOsE,IACdtW,EAAAC,EAAAC,cAAA,OAAK2F,GAAG,SACN7F,EAAAC,EAAAC,cAACgY,GAAD,MACAlY,EAAAC,EAAAC,cAACiY,EAAA,EAAD,KACEnY,EAAAC,EAAAC,cAACkY,EAAA,EAAD,CAAOC,OAAK,EAACC,KAAK,IAAIC,UAAWC,KACjCxY,EAAAC,EAAAC,cAACkY,EAAA,EAAD,CAAOE,KAAK,SAASC,UAAWzQ,KAChC9H,EAAAC,EAAAC,cAACkY,EAAA,EAAD,CAAOE,KAAK,SAASC,UAAWE,eAT1BC,aAiBHvY,2BE1Cf+P,EAAAC,QAAA,CAAkB+E,KAAA","file":"static/js/main.1ed379fe.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport registerServiceWorker from './registerServiceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n","/**\n * Created by vivalaakam on 17.01.2019.\n *\n * @flow\n */\nimport Subscription from '../api/subscription'\n\nconst subscriptionApi = new Subscription()\n\nfunction urlB64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4)\n  const base64 = (base64String + padding)\n    .replace(/\\-/g, '+')\n    .replace(/_/g, '/')\n\n  const rawData = window.atob(base64)\n  const outputArray = new Uint8Array(rawData.length)\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i)\n  }\n  return outputArray\n}\n\nexport default class PushManager {\n  static single = new PushManager()\n\n  constructor() {\n    if (typeof navigator !== 'undefined' && typeof window !== 'undefined' && 'serviceWorker' in navigator && 'PushManager' in window) {\n      this.run()\n    }\n  }\n\n  async run() {\n    try {\n      this.serviceWorker = await navigator.serviceWorker.register(`${process.env.PUBLIC_URL}/push-worker.js`)\n      const subscription = await this.serviceWorker.pushManager.getSubscription()\n\n      this.hasSubscription = !(subscription === null)\n    } catch (e) {\n      console.error('Service Worker Error', e)\n    }\n  }\n\n  async subscribeUser() {\n    if (!this.serviceWorker) {\n      return\n    }\n    try {\n      const subscription = await this.serviceWorker.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlB64ToUint8Array(process.env.VAPID_PUBLIC_KEY)\n      })\n\n      try {\n        const resp = await subscriptionApi.create({\n          subscription: {\n            subscription: JSON.stringify(subscription),\n            source: 'web'\n          }\n        })\n        this.hasSubscription = true\n        return resp\n      } catch (e) {\n        this.hasSubscription = false\n      }\n    } catch (err) {\n      console.log('Failed to subscribe the user: ', err)\n    }\n  }\n\n  async unsubscribeUser() {\n    if (!this.serviceWorker) {\n      return\n    }\n\n    const subscription = await this.serviceWorker.pushManager.getSubscription()\n    if (subscription) {\n      this.hasSubscription = false\n      return subscription.unsubscribe()\n    }\n\n    return false\n\n  }\n}\n\n","/**\n * Created by vivalaakam on 17.01.2019.\n *\n * @flow\n */\nimport Rest from './rest'\n\nexport default class Subscription extends Rest {\n  constructor() {\n    super('api/subscription')\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\nimport { fork, put, select, take, takeLatest } from 'redux-saga/effects'\nimport token from '../utils/token'\nimport PushManager from '../utils/PushManager'\nimport { eventChannel } from 'redux-saga'\nimport WS from '../utils/WS'\nimport { chatsUpdate } from './chats'\n\nconst $$initialState = {\n  loaded: false\n}\n\nexport const USER_UPDATE = 'USER_UPDATE'\nconst USER_APPLY = 'USER_APPLY'\n\n\nexport default function user($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case USER_UPDATE:\n      return {\n        ...$$state,\n        ...payload\n      }\n    default:\n      return $$state\n  }\n}\n\nexport const userUpdate = createAction(USER_UPDATE)\nexport const userApply = createAction(USER_APPLY)\n\nfunction* userApplyAction({ payload }) {\n  try {\n    token.setToken(payload.token)\n\n    const subscription = yield PushManager.single.subscribeUser()\n\n    if (subscription) {\n      localStorage.setItem('subscription', subscription.data.id)\n    }\n    yield fork(userSubscribe)\n    yield put(userUpdate(payload))\n  } catch (e) {\n    console.log('userApplyAction', e.message)\n  }\n}\n\nfunction* userSubscribe() {\n  let subscription\n  try {\n    const user = yield select(getUser)\n    subscription = eventChannel((emitter) => {\n      const chan = WS.single.join(`user:${user.id}`, {})\n      chan.on('on_chat', emitter)\n\n      return () => {\n        WS.single.leave(chan)\n      }\n    })\n\n    while (true) {\n      const data = yield take(subscription)\n      yield put(chatsUpdate(data))\n    }\n\n  } catch (e) {\n    console.log('chatSubscribe', e.message)\n  } finally {\n    if (subscription.close) {\n      subscription.close()\n    }\n  }\n}\n\nexport function getUser(state) {\n  return state.user\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, USER_APPLY, userApplyAction)\n\n  if (token.getToken()) {\n    yield fork(userSubscribe)\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nconst KEY = 'jwtToken'\n\nexport default {\n  getToken() {\n    return typeof localStorage !== 'undefined' && localStorage.getItem(KEY)\n  },\n  setToken(jwt) {\n    if (jwt) {\n      localStorage.setItem(KEY, jwt)\n      document.cookie = `Authorization=Bearer ${jwt}`\n    }\n  },\n  removeToken() {\n    localStorage.setItem(KEY, null)\n    document.cookie = 'Authorization='\n  }\n}\n","/**\n * Created by vivalaakam on 20.06.2018.\n *\n * @flow\n */\n\nimport { fork, put, select, takeLatest } from 'redux-saga/effects'\nimport { createAction } from 'redux-actions'\nimport { getUser, USER_UPDATE } from './user'\nimport Chats from '../api/chats'\n\nconst chatsApi = new Chats()\n\nconst $$initialState = []\n\nconst CHATS_UPDATE = 'CHATS_UPDATE'\nconst CHATS_RESET = 'CHATS_RESET'\nconst CHATS_ADD = 'CHATS_ADD'\n\nfunction replace($$state, item) {\n  const tmp = $$state.reduce((state, chat) => ({ ...state, [chat.id]: chat }), {})\n\n  tmp[item.id] = item\n\n  return sort(Object.values(tmp))\n}\n\nfunction sort($$state) {\n  return $$state\n    .map(c => ({\n      ...c,\n      last: c.last || new Date((c.last_message && c.last_message.inserted_at) || new Date(c.inserted_at))\n    }))\n    .sort((a, b) => b.last - a.last)\n}\n\nexport default function chats($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case CHATS_UPDATE:\n      return replace($$state, payload)\n    case CHATS_RESET:\n      return sort(payload)\n    case CHATS_ADD:\n      return sort($$state.concat(payload))\n    default:\n      return $$state\n  }\n}\n\nexport const chatsReset = createAction(CHATS_RESET)\nexport const chatsAdd = createAction(CHATS_ADD)\nexport const chatsUpdate = createAction(CHATS_UPDATE)\n\nfunction* onChatsUpdate() {\n  try {\n    const { token } = yield select(getUser)\n    if (token) {\n      const chats = yield chatsApi.all()\n      yield put(chatsReset(chats.data))\n    } else {\n      yield put(chatsReset([]))\n    }\n  } catch (e) {\n    console.log('init', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(onChatsUpdate)\n  yield fork(takeLatest, USER_UPDATE, onChatsUpdate)\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\n\nconst $$initialState = []\n\nconst MESSAGES_UPDATE = 'MESSAGES_UPDATE'\nconst MESSAGES_RESET = 'MESSAGES_RESET'\n\nfunction prepareMessages($$state, payload) {\n  if (payload.length === 0) {\n    return $$state\n  }\n\n  const messages = payload.map(message => ({\n    ...message,\n    inserted_at: new Date(message.inserted_at)\n  }))\n  const sorted = $$state.concat(messages).sort((a, b) => a.inserted_at - b.inserted_at)\n\n  let prev = sorted.shift()\n  let curr = sorted.shift()\n\n  const res = [prev]\n\n  while (sorted.length) {\n    curr.in_block = prev.sender_id === curr.sender_id\n    res.push(curr)\n    prev = curr\n    curr = sorted.shift()\n  }\n  if (!!curr) {\n    res.push(curr)\n  }\n  return res\n}\n\nexport default function messages($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case MESSAGES_RESET: {\n      return prepareMessages($$initialState, payload)\n    }\n    case MESSAGES_UPDATE: {\n      return prepareMessages($$state, payload)\n    }\n    default:\n      return $$state\n  }\n}\n\nexport const getMessages = state => state.messages\n\nexport const messagesUpdate = createAction(MESSAGES_UPDATE)\nexport const messagesReset = createAction(MESSAGES_RESET)\n","/**\n * Created by vivalaakam on 04.05.2018.\n *\n * @flow\n */\n\nimport token from '../utils/token'\n\nexport default class Rest {\n  url = process.env.PROXY_SERVER\n\n  constructor(url) {\n    this.base_url = url\n  }\n\n  getUrl = (subpath = '', params = null) => {\n    if (!params) {\n      return `${this.url}/${this.base_url}${subpath}`\n    }\n\n    return `${this.url}/${this.base_url}${subpath}?${params}`\n  }\n\n  create(data) {\n    return this.postQuery(`${this.getUrl()}`, data)\n  }\n\n  update(id, data) {\n    return this.putQuery(`${this.getUrl()}/${id}`, data)\n  }\n\n  fetch(id) {\n    return this.getQuery(`${this.getUrl()}/${id}`)\n  }\n\n  all() {\n    return this.getQuery(`${this.getUrl()}`)\n  }\n\n  remove(id) {\n    return this.deleteQuery(`${this.getUrl()}/${id}`)\n  }\n\n  async getQuery(url) {\n    const jwt = token.getToken()\n    const resp = await fetch(url, this.options(jwt))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async postQuery(url, data) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'POST',\n      body: JSON.stringify(data)\n    }))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async putQuery(url, data) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    }))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async deleteQuery(url) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'DELETE'\n    }))\n    const response = Rest.afterQuery(resp)\n    return true\n  }\n\n  static async handleError(response) {\n    const resp = await response.json()\n    throw new Error(resp.message)\n  }\n\n  static afterQuery(response) {\n    if (!response.ok) {\n      return Rest.handleError(response)\n    }\n\n    return response\n  }\n\n  options(token, params = {}) {\n    const headers = {\n      Authorization: `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    }\n\n    return {\n      headers,\n      mode: 'cors',\n      credentials: 'include',\n      ...params\n    }\n  }\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\nimport Rest from './rest'\nimport queryString from 'query-string'\n\nexport default class Chats extends Rest {\n  constructor() {\n    super('api/chats')\n  }\n\n  messages(id, last_message = null) {\n    return this.getQuery(this.getUrl(`/${id}/messages`, queryString.stringify({ last_message })))\n  }\n\n  message(id, message) {\n    return this.postQuery(`${this.getUrl()}/${id}/message`, { message: { message } })\n  }\n}\n","/**\n * Created by vivalaakam on 19.01.2019.\n *\n * @flow\n */\nimport { Socket } from 'phoenix'\nimport token from './token'\n\nexport default class WS {\n  static single = new WS()\n\n  constructor() {\n    this._socket = null\n    this._connections = []\n  }\n\n  connect() {\n    if (!this._socket) {\n      const guardian_token = token.getToken()\n      this._socket = new Socket(`${process.env.PROXY_SERVER.replace(/^http/, 'ws')}/socket`, {\n        params: { guardian_token }\n      })\n    }\n\n    this._socket.connect()\n  }\n\n  disconnect() {\n    if (this._socket) {\n      this._socket.disconnect()\n    }\n  }\n\n  join(name, params = {}) {\n    if (!this._socket) {\n      this.connect()\n    }\n\n    const chan = this._socket.channel(name, params)\n    chan.join()\n\n    this._connections.push(chan)\n\n    return chan\n  }\n\n  leave(chan) {\n    if (this._connections.length) {\n      this._connections = this._connections.filter((curr) => curr !== chan)\n\n      if (!this._connections.length) {\n        this.disconnect()\n      }\n    }\n  }\n}\n","/**\n * Created by vivalaakam on 20.06.2018.\n *\n * @flow\n */\nexport function getCurrentDateTime(date) {\n  var tzoffset = (date).getTimezoneOffset() * 60000 //offset in milliseconds\n  var localISOTime = (new Date(date - tzoffset)).toISOString().slice(0, 19).replace('T', ' ')\n  var mySqlDT = localISOTime\n  return mySqlDT\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\nimport { Socket } from 'phoenix'\nimport { eventChannel } from 'redux-saga'\nimport { createAction } from 'redux-actions'\nimport { cancel, fork, put, select, take, takeLatest } from 'redux-saga/effects'\nimport Chats from '../api/chats'\nimport { getMessages, messagesReset, messagesUpdate } from './messages'\nimport { getCurrentDateTime } from '../utils/date'\nimport WS from '../utils/WS'\n\nconst $$initialState = {\n  loaded: false,\n  loading: false,\n  can_load: true\n}\n\nconst chatsAPI = new Chats()\n\nexport const CHAT_INIT = 'CHAT_INIT'\nexport const CHAT_LOAD = 'CHAT_LOAD'\nexport const CHAT_RESET = 'CHAT_RESET'\nexport const CHAT_UPDATE = 'CHAT_UPDATE'\nexport const CHAT_UNMOUNT = 'CHAT_UNMOUNT'\nexport const CHAT_MESSAGE = 'CHAT_MESSAGE'\n\nexport default function chat($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case CHAT_RESET:\n      return {\n        ...$$initialState,\n        ...payload\n      }\n    case CHAT_UPDATE:\n      return {\n        ...$$state,\n        ...payload\n      }\n    default:\n      return $$state\n  }\n}\n\nexport const chatInit = createAction(CHAT_INIT)\nexport const chatLoad = createAction(CHAT_LOAD)\nexport const chatReset = createAction(CHAT_RESET)\nexport const chatUpdate = createAction(CHAT_UPDATE)\nexport const chatUnmount = createAction(CHAT_UNMOUNT)\nexport const chatMessage = createAction(CHAT_MESSAGE)\n\nexport const getChat = state => state.chat\n\nlet chatSubscription\n\nexport function* onChatInit({ payload }) {\n  try {\n    if (chatSubscription) {\n      yield cancel(chatSubscription)\n    }\n    const resp = yield chatsAPI.fetch(payload)\n    yield put(chatUpdate({ ...resp.data, can_load: resp.data.messages.length === 25 }))\n    yield put(messagesReset(resp.data.messages))\n    chatSubscription = yield fork(chatSubscribe, resp.data.id)\n  } catch (e) {\n    console.log('onChatInit', e.message)\n  }\n}\n\n\nfunction* chatSubscribe(chatId) {\n  let subscription\n  try {\n\n    subscription = eventChannel((emitter) => {\n      const chan = WS.single.join(`chat:${chatId}`, {})\n      chan.on('on_message', emitter)\n\n      return () => {\n        WS.single.leave(chan)\n      }\n    })\n\n    while (true) {\n      const data = yield take(subscription)\n      yield put(messagesUpdate([data]))\n      yield put(chatUpdate({ last_message: data }))\n    }\n\n  } catch (e) {\n    console.log('chatSubscribe', e.message)\n  } finally {\n    if (subscription.close) {\n      subscription.close()\n    }\n  }\n}\n\nfunction* onChatMessage({ payload }) {\n  try {\n    const chat = yield select(getChat)\n    yield chatsAPI.message(chat.id, payload.trim())\n  } catch (e) {\n    console.log('onChatMessage', e.message)\n  }\n}\n\nfunction* onChatLoad() {\n  try {\n    yield put(chatUpdate({ loading: true }))\n    const chat = yield select(getChat)\n    const msgs = yield select(getMessages)\n    const last = msgs[0]\n    const messages = yield chatsAPI.messages(chat.id, getCurrentDateTime(last.inserted_at))\n    yield put(chatUpdate({ loading: false, can_load: messages.data.length === 25, loaded: true }))\n    yield put(messagesUpdate(messages.data))\n  } catch (e) {\n    console.log('onChatLoad', e.message)\n  }\n}\n\nfunction* onChatUnmount() {\n  try {\n    yield put(chatReset({}))\n    yield put(messagesReset([]))\n    if (chatSubscription) {\n      yield cancel(chatSubscription)\n    }\n  } catch (e) {\n    console.log('onChatUnmount', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, CHAT_INIT, onChatInit)\n  yield fork(takeLatest, CHAT_LOAD, onChatLoad)\n  yield fork(takeLatest, CHAT_UNMOUNT, onChatUnmount)\n  yield fork(takeLatest, CHAT_MESSAGE, onChatMessage)\n}\n","/**\n * Created by vivalaakam on 04.05.2018.\n *\n * @flow\n */\nimport queryString from 'query-string';\nimport Rest from './rest';\n\nexport default class Users extends Rest {\n  constructor() {\n    super('api/users');\n  }\n\n  update(data) {\n    return this.postQuery(this.getUrl(), data);\n  }\n\n  fetch(full = false) {\n    return this.getQuery(this.getUrl('', queryString.stringify({ full })));\n  }\n\n  list(users = []) {\n    const string = queryString.stringify({ users }, { arrayFormat: 'bracket' });\n    return this.getQuery(this.getUrl('/list', string));\n  }\n}\n","/**\n * Created by vivalaakam on 08.05.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\nimport { push } from 'connected-react-router'\nimport { fork, put, select, takeLatest } from 'redux-saga/effects'\nimport Users from '../api/users'\nimport { getUser } from './user'\nimport Chats from '../api/chats'\nimport { chatsAdd } from './chats'\n\nconst userApi = new Users()\nconst chatApi = new Chats()\nconst $$initialState = []\n\nexport const USERS_UPDATE = 'USERS_UPDATE'\nexport const USERS_FETCH = 'USERS_FETCH'\nexport const USERS_RESET = 'USERS_RESET'\nexport const USERS_PRIVATE_CHAT = 'USERS_PRIVATE_CHAT'\nexport const USERS_INIT = 'USERS_INIT'\n\nexport default function user($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case USERS_RESET:\n      return payload\n    case USERS_UPDATE:\n      return $$state.concat(payload)\n    default:\n      return $$state\n  }\n}\n\nexport const usersUpdate = createAction(USERS_UPDATE)\nexport const usersReset = createAction(USERS_RESET)\nexport const usersFetch = createAction(USERS_FETCH)\nexport const usersPrivateChat = createAction(USERS_PRIVATE_CHAT)\n\nexport function* onUsersInit() {\n  try {\n    const user = yield select(getUser)\n    const users = yield userApi.all()\n    const data = users.data.filter((u) => (u.id !== user.id))\n    yield put(usersReset(data))\n  } catch (e) {\n    console.log('onUsersInit', e.message)\n  }\n}\n\nfunction* onUsersPrivateChat({ payload }) {\n  try {\n    const user = yield select(getUser)\n    const chat = yield chatApi.create({ chat: { name: 'private', is_private: true, users: [payload.id, user.id] } })\n    yield put(push(`/chats/${chat.data.id}`))\n    yield put(chatsAdd({\n      ...chat.data,\n      last: new Date()\n    }))\n  } catch (e) {\n    console.log('onUsersPrivateChat', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, USERS_PRIVATE_CHAT, onUsersPrivateChat)\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Btn\":\"Btn_Btn___6Qbu\",\"defaultScheme\":\"Btn_defaultScheme__2FZxQ\",\"active\":\"Btn_active__1sQMl\",\"inverted\":\"Btn_inverted__3hx0f\",\"blueScheme\":\"Btn_blueScheme__1HpUY\",\"greenScheme\":\"Btn_greenScheme__2wwnR\",\"orangeScheme\":\"Btn_orangeScheme__eglMg\",\"githubScheme\":\"Btn_githubScheme__3P5DQ\",\"googleScheme\":\"Btn_googleScheme__gelXl\",\"facebookScheme\":\"Btn_facebookScheme__3T4xQ\"};","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport classnames from 'classnames'\nimport style from './Btn.scss'\n\nexport default function Btn({ children, className, onClick, name, active, inverted, disabled, scheme }) {\n  const cName = classnames(style.Btn, style[`${scheme}Scheme`], className, {\n    [style.active]: active,\n    [style.inverted]: inverted\n  })\n  return (\n    <button className={cName} {...{ name, disabled, onClick }}>{children}</button>\n  )\n}\n\nBtn.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.element\n  ]).isRequired,\n  name: PropTypes.string,\n  className: PropTypes.string,\n  onClick: PropTypes.func.isRequired,\n  active: PropTypes.bool,\n  disabled: PropTypes.bool,\n  inverted: PropTypes.bool,\n  scheme: PropTypes.oneOf(['default', 'green', 'blue', 'orange', 'github', 'google', 'facebook'])\n}\n\nBtn.defaultProps = {\n  scheme: 'default',\n  name: '',\n  className: '',\n  disabled: false,\n  inverted: false,\n  active: false\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Modal\":\"Modal_Modal__2Ff3a\",\"wrapper\":\"Modal_wrapper__17Z-7\"};","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport createHistory from 'history/createBrowserHistory'\nimport { hasWindow } from './helpers'\n\nexport default hasWindow && createHistory()\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nexport const hasWindow = typeof window !== 'undefined'\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\nimport { Provider } from 'react-redux'\nimport { ConnectedRouter } from 'connected-react-router'\nimport history from './utils/history'\n\nexport default function Wrapper({ store, children }) {\n  if (history) {\n    return (\n      <Provider store={store}>\n        <ConnectedRouter history={history}>\n          {children}\n        </ConnectedRouter>\n      </Provider>\n    )\n  }\n\n  return (\n    <Provider store={store}>\n      {children}\n    </Provider>\n  )\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\n\nconst Loading = () => (\n  <div>Loading</div>\n)\n\nexport default Loading\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\n\nconst UPDATE_STATE = 'UPDATE_STATE'\n\nexport default function outer(reducer) {\n  return function outerReducer(state, action) {\n    switch (action.type) {\n      case UPDATE_STATE:\n        return reducer({ ...state, ...action.payload }, action)\n      default:\n        return reducer(state, action)\n    }\n  }\n}\n\nexport const updateState = createAction(UPDATE_STATE)\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { all, call, fork } from 'redux-saga/effects'\nimport { router } from 'redux-saga-router'\nimport history from '../utils/history'\n\nimport { onChatInit, watcher as chatWatcher } from './chat'\nimport { watcher as userWatcher } from './user'\nimport { watcher as chatsWatcher } from './chats'\nimport { onUsersInit, watcher as usersWatcher } from './users'\n\nconst routes = {\n  * '/chats'() {\n    yield call(onUsersInit)\n  },\n  * '/chats/:chatId'({ chatId }) {\n    yield call(onChatInit, { payload: chatId })\n  }\n}\n\nexport default function* rootSaga() {\n  const sagas = [\n    chatWatcher(),\n    userWatcher(),\n    chatsWatcher(),\n    usersWatcher()\n  ]\n\n  if (history) {\n    sagas.unshift(router(history, routes))\n  }\n\n  yield fork(all, sagas)\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { applyMiddleware, compose, createStore } from 'redux'\nimport thunk from 'redux-thunk'\nimport createSagaMiddleware from 'redux-saga'\nimport { updateState } from '../reducers/outer'\nimport createReducers from './index'\nimport { hasWindow } from '../utils/helpers'\nimport history from '../utils/history'\nimport sagas from './sagas'\nimport persistState from 'redux-localstorage'\n\nconst sagaMiddleware = createSagaMiddleware()\n\n\nconst middleware = [\n  thunk,\n  sagaMiddleware,\n]\n\nif (process.env.NODE_ENV === 'development' && hasWindow) {\n  const { createLogger } = require('redux-logger')\n\n  const logger = createLogger({\n    actionTransformer: action => ({\n      ...action,\n      type: String(action.type)\n    })\n  })\n\n\n  middleware.push(logger)\n}\n\nexport default function configureStore(initialState) {\n  const middle = [...middleware]\n  if (history) {\n    const router = require('connected-react-router')\n    middle.push(router.routerMiddleware(history))\n  }\n\n  const composeEnhancers = (window && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose\n\n  const store = createStore(\n    createReducers(history),\n    {},\n    composeEnhancers(applyMiddleware(...middle), persistState(['user']))\n  )\n\n  store.updateState = (state) => {\n    const keys = Object.keys(store.getState())\n    const filtered = keys.reduce((st, key) => {\n      if (Object.prototype.hasOwnProperty.call(state, key)) {\n        st[key] = state[key]\n      }\n      return st\n    }, {})\n\n    return store.dispatch(updateState(filtered))\n  }\n  store.runSaga = sagaMiddleware.run\n  store.asyncReducers = {}\n\n  store.updateState(initialState)\n\n  /* istanbul ignore next */\n  if (module.hot) {\n    module.hot.accept('./index', () => {\n      import('./index').then((reducerModule) => {\n        const createReducersLoaded = reducerModule.default\n        const nextReducers = createReducersLoaded({ ...store.asyncReducers })\n\n        store.replaceReducer(nextReducers)\n      })\n    })\n  }\n\n  sagaMiddleware.run(sagas)\n\n  return store\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React, { PureComponent } from 'react'\nimport ReactDOM from 'react-dom'\nimport classnames from 'classnames'\nimport styles from './Modal.scss'\n\nconst modalRoot = document.getElementById('modal')\n\nexport default class Modal extends PureComponent {\n  constructor(props) {\n    super(props)\n    this.el = document.createElement('div')\n  }\n\n  componentDidMount() {\n    // The portal element is inserted in the DOM tree after\n    // the Modal's children are mounted, meaning that children\n    // will be mounted on a detached DOM node. If a child\n    // component requires to be attached to the DOM tree\n    // immediately when mounted, for example to measure a\n    // DOM node, or uses 'autoFocus' in a descendant, add\n    // state to Modal and only render the children when Modal\n    // is inserted in the DOM tree.\n    modalRoot.appendChild(this.el)\n  }\n\n  componentWillUnmount() {\n    modalRoot.removeChild(this.el)\n  }\n\n  render() {\n    return ReactDOM.createPortal(\n      this.renderWrapper(),\n      this.el\n    )\n  }\n\n  renderWrapper() {\n    const style = classnames(styles.wrapper, this.props.className)\n    return (\n      <div className={styles.Modal}>\n        <div className={style}>\n          {this.props.children}\n        </div>\n      </div>\n    )\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nexport default function loginPopup(provider) {\n  return new Promise((resolve) => {\n    let win\n    const curWidth = document.body.offsetWidth\n    const curLeft = window.screenLeft\n    const leftPos = curLeft + (curWidth / 2) - 500\n\n    const curTop = window.screenTop\n    const topPos = curTop + 100\n\n    function receiveMessage(result) {\n      if (result.data.id) {\n        resolve(result.data)\n        win.close()\n      }\n    }\n\n    window.addEventListener('message', receiveMessage, false)\n    const features = `status=no,scrollbar=yes,resizable=yes,width=1000,height=800,top=${topPos},left=${leftPos}`\n    console.log(`${process.env.PROXY_SERVER}/auth/${provider}`);\n    win = window.open(`${process.env.PROXY_SERVER}/auth/${provider}`, 'auth_popup', features)\n  })\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React, { PureComponent } from 'react'\nimport Modal from '../Modal/Modal'\n\nimport styles from './Auth.scss'\nimport Btn from '../UI/Btn/Btn'\nimport loginPopup from '../../utils/loginPopup'\n\nexport default class Auth extends PureComponent {\n  render() {\n    return (\n      <Modal className={styles.Auth}>\n        <Btn onClick={this.onClickFacebook} scheme=\"facebook\">\n          Login with Facebook\n        </Btn>\n        <Btn onClick={this.onClickGoogle} scheme=\"google\">\n          Login with Google\n        </Btn>\n      </Modal>\n    )\n  }\n\n  onClickFacebook = (e) => {\n    if (e) {\n      e.preventDefault()\n    }\n    loginPopup('facebook')\n      .then((data) => {\n        this.props.applyAuth(data)\n      })\n      .catch((error) => {\n        /* eslint no-console: [\"error\", { allow: [\"log\"] }] */\n        console.log(error.message)\n      })\n  }\n\n  onClickGoogle = (e) => {\n    if (e) {\n      e.preventDefault()\n    }\n\n    loginPopup('google')\n      .then((data) => {\n        this.props.applyAuth(data)\n      })\n      .catch((error) => {\n        /* eslint no-console: [\"error\", { allow: [\"log\"] }] */\n        console.log(error.message)\n      })\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\nimport { connect } from 'react-redux'\n\nimport AuthComponent from '../Components/Auth/Auth'\nimport { userApply } from '../reducers/user'\n\nconst mapStateToProps = state => ({\n  user: state.user\n})\n\nconst mapDispathToProps = dispatch => ({\n  applyAuth(data) {\n    dispatch(userApply(data))\n  }\n})\n\nclass Auth extends PureComponent {\n  render() {\n    if (this.props.user.id) {\n      return null\n    }\n\n    return (\n      <AuthComponent applyAuth={this.props.applyAuth} />\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispathToProps)(Auth)\n","/**\n * Created by vivalaakam on 18.01.2019.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\nimport { Redirect } from 'react-router-dom'\n\nclass HomeContainer extends PureComponent {\n  render() {\n    return (\n      <Redirect to=\"/chats\" />\n    )\n  }\n}\n\n\nexport default HomeContainer\n","/**\n * Created by vivalaakam on 18.01.2019.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\n\nclass TermsContainer extends PureComponent {\n  render() {\n    return (\n      <p>      </p>\n    )\n  }\n}\n\n\nexport default TermsContainer\n","import React, { Component } from 'react'\nimport { Route, Switch } from 'react-router-dom'\nimport Loadable from 'react-loadable'\n\nimport Wrapper from './Wrapper'\nimport Loading from './Loading'\nimport configureStore from './reducers/store'\nimport Auth from './Containers/Auth'\nimport Home from './Containers/Home'\nimport Terms from './Containers/Terms'\n\nexport function loadableFactory(loader) {\n  return Loadable({\n    loader,\n    loading: Loading,\n    render(loaded, props) {\n      const Comp = loaded.default\n      return <Comp {...props} />\n    }\n  })\n}\n\nconst Chats = loadableFactory(() => import('./Containers/Chats'))\n\nconst userStore = configureStore(window.__INITIAL_STATE__ || {})\n\nclass App extends Component {\n  render() {\n    return (\n      <Wrapper store={userStore}>\n        <div id=\"inner\">\n          <Auth />\n          <Switch>\n            <Route exact path=\"/\" component={Home} />\n            <Route path=\"/chats\" component={Chats} />\n            <Route path=\"/terms\" component={Terms} />\n          </Switch>\n        </div>\n      </Wrapper>\n    )\n  }\n}\n\nexport default App\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { combineReducers } from 'redux'\nimport { connectRouter } from 'connected-react-router'\n\n\nimport messages from './messages'\nimport outer from './outer'\nimport users from './users'\nimport chats from './chats'\nimport user from './user'\nimport chat from './chat'\n\nexport default function reducers(history, ext = {}) {\n  return outer(combineReducers({ router: connectRouter(history), user, chat, chats, users, outer, messages, ...ext }))\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Auth\":\"Auth_Auth__2lPSo\"};"],"sourceRoot":""}