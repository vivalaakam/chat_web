{"version":3,"sources":["registerServiceWorker.js","index.js","utils/PushManager.js","api/subscription.js","reducers/user.js","utils/token.js","reducers/chats.js","reducers/messages.js","api/rest.js","api/chats.js","utils/WS.js","utils/date.js","reducers/chat.js","api/users.js","reducers/users.js","Components/UI/Btn/Btn.scss","Components/Modal/Modal.scss","Components/UI/Btn/Btn.js","utils/history.js","utils/helpers.js","Wrapper.js","Loading.js","reducers/outer.js","reducers/sagas.js","reducers/store.js","Components/Modal/Modal.js","Components/Auth/Auth.js","utils/loginPopup.js","Containers/Auth.js","Containers/Home.js","Containers/Terms.js","App.js","reducers/index.js","Components/Auth/Auth.scss"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","catch","error","ReactDOM","render","react_default","a","createElement","App","document","getElementById","URL","process","origin","addEventListener","concat","fetch","response","status","headers","get","indexOf","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker","subscriptionApi","Subscription","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","Rest","urlB64ToUint8Array","base64String","base64","repeat","length","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","PushManager","run","pushManager","getSubscription","subscription","hasSubscription","_context","t0","subscribe","userVisibleOnly","applicationServerKey","create","JSON","stringify","source","resp","_context2","t1","unsubscribe","single","userApplyAction","userSubscribe","watcher","$$initialState","loaded","USER_UPDATE","USER_APPLY","user","$$state","arguments","undefined","_ref","type","payload","objectSpread","userUpdate","createAction","userApply","_ref2","regenerator_default","wrap","prev","next","token","setToken","subscribeUser","sent","localStorage","setItem","data","id","fork","put","message","stop","_marked","_user","select","getUser","eventChannel","emitter","chan","WS","join","on","leave","take","chatsUpdate","close","finish","_marked2","_context3","takeLatest","getToken","_marked3","KEY","__webpack_exports__","getItem","jwt","cookie","removeToken","onChatsUpdate","chatsApi","Chats","CHATS_UPDATE","CHATS_RESET","CHATS_ADD","sort","map","c","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_2__","last","Date","last_message","inserted_at","b","chats","item","tmp","reduce","chat","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_1__","values","chatsReset","_chats","_Users_user_work_chat_web_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","all","MESSAGES_UPDATE","MESSAGES_RESET","prepareMessages","messages","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","sorted","shift","curr","res","in_block","sender_id","push","getMessages","messagesUpdate","messagesReset","url","_this","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__","getUrl","subpath","params","base_url","postQuery","putQuery","getQuery","deleteQuery","options","afterQuery","json","method","body","Authorization","Content-Type","mode","credentials","Error","ok","handleError","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","queryString","_socket","_connections","guardian_token","Socket","connect","disconnect","name","channel","filter","getCurrentDateTime","date","tzoffset","getTimezoneOffset","toISOString","slice","onChatInit","chatSubscribe","onChatMessage","onChatLoad","onChatUnmount","loading","can_load","chatsAPI","CHAT_INIT","CHAT_LOAD","CHAT_RESET","CHAT_UPDATE","CHAT_UNMOUNT","CHAT_MESSAGE","chatSubscription","chatLoad","chatReset","chatUpdate","chatMessage","getChat","cancel","chatId","_ref3","_chat","trim","_chat2","msgs","_context4","_marked4","_context5","_marked5","_context6","_marked6","Users","full","users","string","arrayFormat","onUsersInit","onUsersPrivateChat","userApi","chatApi","USERS_UPDATE","USERS_RESET","USERS_PRIVATE_CHAT","usersReset","usersPrivateChat","u","_user2","is_private","module","exports","Btn","defaultScheme","active","inverted","blueScheme","greenScheme","orangeScheme","githubScheme","googleScheme","facebookScheme","Modal","wrapper","_classnames","children","className","onClick","disabled","scheme","cName","classnames","style","_Users_user_work_chat_web_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1___default","assign","defaultProps","hasWindow","createHistory","Wrapper","store","history","es","esm","Loading","UPDATE_STATE","outer","reducer","action","updateState","rootSaga","routes","/chats","mark","/chats/:chatId","chatsChatId","sagas","chatWatcher","userWatcher","chatsWatcher","usersWatcher","unshift","router","sagaMiddleware","createSagaMiddleware","middleware","thunk","modalRoot","props","el","appendChild","removeChild","createPortal","renderWrapper","styles","PureComponent","Auth","onClickLogin","e","provider","preventDefault","Promise","resolve","win","curWidth","offsetWidth","leftPos","screenLeft","topPos","screenTop","result","features","open","applyAuth","Modal_Modal_Modal","Auth_Auth_Auth","dispatch","HomeContainer","Redirect","to","TermsContainer","loadableFactory","loader","Loadable","Comp","default","__webpack_require__","bind","userStore","initialState","middle","require","routerMiddleware","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","createStore","ext","combineReducers","connectRouter","createReducers","applyMiddleware","apply","toConsumableArray","persistState","filtered","keys","getState","st","key","prototype","hasOwnProperty","runSaga","asyncReducers","configureStore","__INITIAL_STATE__","Containers_Auth","Switch","Route","exact","path","component","Home","Terms","Component"],"mappings":"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","file":"static/js/main.871cada6.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport registerServiceWorker from './registerServiceWorker'\n\nReactDOM.render(<App />, document.getElementById('root'))\nregisterServiceWorker()\n\nif (module.hot) {\n  module.hot.accept()\n}\n","/**\n * Created by vivalaakam on 17.01.2019.\n *\n * @flow\n */\nimport Subscription from '../api/subscription'\n\nconst subscriptionApi = new Subscription()\n\nfunction urlB64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4)\n  const base64 = (base64String + padding)\n    .replace(/\\-/g, '+')\n    .replace(/_/g, '/')\n\n  const rawData = window.atob(base64)\n  const outputArray = new Uint8Array(rawData.length)\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i)\n  }\n  return outputArray\n}\n\nexport default class PushManager {\n  static single = new PushManager()\n\n  constructor() {\n    if (typeof navigator !== 'undefined' && typeof window !== 'undefined' && 'serviceWorker' in navigator && 'PushManager' in window) {\n      this.run()\n    }\n  }\n\n  async run() {\n    try {\n      this.serviceWorker = await navigator.serviceWorker.register(`${process.env.PUBLIC_URL}/push-worker.js`)\n      const subscription = await this.serviceWorker.pushManager.getSubscription()\n\n      this.hasSubscription = !(subscription === null)\n    } catch (e) {\n      console.error('Service Worker Error', e)\n    }\n  }\n\n  async subscribeUser() {\n    if (!this.serviceWorker) {\n      return\n    }\n    try {\n      const subscription = await this.serviceWorker.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlB64ToUint8Array(process.env.VAPID_PUBLIC_KEY)\n      })\n\n      try {\n        const resp = await subscriptionApi.create({\n          subscription: {\n            subscription: JSON.stringify(subscription),\n            source: 'web'\n          }\n        })\n        this.hasSubscription = true\n        return resp\n      } catch (e) {\n        this.hasSubscription = false\n      }\n    } catch (err) {\n      console.log('Failed to subscribe the user: ', err)\n    }\n  }\n\n  async unsubscribeUser() {\n    if (!this.serviceWorker) {\n      return\n    }\n\n    const subscription = await this.serviceWorker.pushManager.getSubscription()\n    if (subscription) {\n      this.hasSubscription = false\n      return subscription.unsubscribe()\n    }\n\n    return false\n\n  }\n}\n\n","/**\n * Created by vivalaakam on 17.01.2019.\n *\n * @flow\n */\nimport Rest from './rest'\n\nexport default class Subscription extends Rest {\n  constructor() {\n    super('api/subscription')\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\nimport { fork, put, select, take, takeLatest } from 'redux-saga/effects'\nimport token from '../utils/token'\nimport PushManager from '../utils/PushManager'\nimport { eventChannel } from 'redux-saga'\nimport WS from '../utils/WS'\nimport { chatsUpdate } from './chats'\n\nconst $$initialState = {\n  loaded: false\n}\n\nexport const USER_UPDATE = 'USER_UPDATE'\nconst USER_APPLY = 'USER_APPLY'\n\n\nexport default function user($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case USER_UPDATE:\n      return {\n        ...$$state,\n        ...payload\n      }\n    default:\n      return $$state\n  }\n}\n\nexport const userUpdate = createAction(USER_UPDATE)\nexport const userApply = createAction(USER_APPLY)\n\nfunction* userApplyAction({ payload }) {\n  try {\n    token.setToken(payload.token)\n\n    const subscription = yield PushManager.single.subscribeUser()\n\n    if (subscription) {\n      localStorage.setItem('subscription', subscription.data.id)\n    }\n    yield fork(userSubscribe)\n    yield put(userUpdate(payload))\n  } catch (e) {\n    console.log('userApplyAction', e.message)\n  }\n}\n\nfunction* userSubscribe() {\n  let subscription\n  try {\n    const user = yield select(getUser)\n    subscription = eventChannel((emitter) => {\n      const chan = WS.single.join(`user:${user.id}`, {})\n      chan.on('on_chat', emitter)\n\n      return () => {\n        WS.single.leave(chan)\n      }\n    })\n\n    while (true) {\n      const data = yield take(subscription)\n      yield put(chatsUpdate(data))\n    }\n\n  } catch (e) {\n    console.log('chatSubscribe', e.message)\n  } finally {\n    if (subscription.close) {\n      subscription.close()\n    }\n  }\n}\n\nexport function getUser(state) {\n  return state.user\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, USER_APPLY, userApplyAction)\n\n  if (token.getToken()) {\n    yield fork(userSubscribe)\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nconst KEY = 'jwtToken'\n\nexport default {\n  getToken() {\n    return typeof localStorage !== 'undefined' && localStorage.getItem(KEY)\n  },\n  setToken(jwt) {\n    if (jwt) {\n      localStorage.setItem(KEY, jwt)\n      document.cookie = `Authorization=Bearer ${jwt}`\n    }\n  },\n  removeToken() {\n    localStorage.setItem(KEY, null)\n    document.cookie = 'Authorization='\n  }\n}\n","/**\n * Created by vivalaakam on 20.06.2018.\n *\n * @flow\n */\n\nimport { fork, put, select, takeLatest } from 'redux-saga/effects'\nimport { createAction } from 'redux-actions'\nimport { getUser, USER_UPDATE } from './user'\nimport Chats from '../api/chats'\n\nconst chatsApi = new Chats()\n\nconst $$initialState = []\n\nconst CHATS_UPDATE = 'CHATS_UPDATE'\nconst CHATS_RESET = 'CHATS_RESET'\nconst CHATS_ADD = 'CHATS_ADD'\n\nfunction replace($$state, item) {\n  const tmp = $$state.reduce((state, chat) => ({ ...state, [chat.id]: chat }), {})\n\n  tmp[item.id] = item\n\n  return sort(Object.values(tmp))\n}\n\nfunction sort($$state) {\n  return $$state\n    .map(c => ({\n      ...c,\n      last: c.last || new Date((c.last_message && c.last_message.inserted_at) || new Date(c.inserted_at))\n    }))\n    .sort((a, b) => b.last - a.last)\n}\n\nexport default function chats($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case CHATS_UPDATE:\n      return replace($$state, payload)\n    case CHATS_RESET:\n      return sort(payload)\n    case CHATS_ADD:\n      return sort($$state.concat(payload))\n    default:\n      return $$state\n  }\n}\n\nexport const chatsReset = createAction(CHATS_RESET)\nexport const chatsAdd = createAction(CHATS_ADD)\nexport const chatsUpdate = createAction(CHATS_UPDATE)\n\nexport function getChats(state) {\n  return state.chats\n}\n\nfunction* onChatsUpdate() {\n  try {\n    const { token } = yield select(getUser)\n    if (token) {\n      const chats = yield chatsApi.all()\n      yield put(chatsReset(chats.data))\n    } else {\n      yield put(chatsReset([]))\n    }\n  } catch (e) {\n    console.log('init', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(onChatsUpdate)\n  yield fork(takeLatest, USER_UPDATE, onChatsUpdate)\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\n\nconst $$initialState = []\n\nconst MESSAGES_UPDATE = 'MESSAGES_UPDATE'\nconst MESSAGES_RESET = 'MESSAGES_RESET'\n\nfunction prepareMessages($$state, payload) {\n  if (payload.length === 0) {\n    return $$state\n  }\n\n  const messages = payload.map(message => ({\n    ...message,\n    inserted_at: new Date(message.inserted_at)\n  }))\n  const sorted = $$state.concat(messages).sort((a, b) => a.inserted_at - b.inserted_at)\n\n  let prev = sorted.shift()\n  let curr = sorted.shift()\n\n  const res = [prev]\n\n  while (sorted.length) {\n    curr.in_block = prev.sender_id === curr.sender_id\n    res.push(curr)\n    prev = curr\n    curr = sorted.shift()\n  }\n  if (!!curr) {\n    res.push(curr)\n  }\n  return res\n}\n\nexport default function messages($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case MESSAGES_RESET: {\n      return prepareMessages($$initialState, payload)\n    }\n    case MESSAGES_UPDATE: {\n      return prepareMessages($$state, payload)\n    }\n    default:\n      return $$state\n  }\n}\n\nexport const getMessages = state => state.messages\n\nexport const messagesUpdate = createAction(MESSAGES_UPDATE)\nexport const messagesReset = createAction(MESSAGES_RESET)\n","/**\n * Created by vivalaakam on 04.05.2018.\n *\n * @flow\n */\n\nimport token from '../utils/token'\n\nconsole.log(process.env.PROXY_SERVER);\n\nexport default class Rest {\n  url = process.env.PROXY_SERVER\n\n  constructor(url) {\n    this.base_url = url\n  }\n\n  getUrl = (subpath = '', params = null) => {\n    if (!params) {\n      return `${this.url}/${this.base_url}${subpath}`\n    }\n\n    return `${this.url}/${this.base_url}${subpath}?${params}`\n  }\n\n  create(data) {\n    return this.postQuery(`${this.getUrl()}`, data)\n  }\n\n  update(id, data) {\n    return this.putQuery(`${this.getUrl()}/${id}`, data)\n  }\n\n  fetch(id) {\n    return this.getQuery(`${this.getUrl()}/${id}`)\n  }\n\n  all() {\n    return this.getQuery(`${this.getUrl()}`)\n  }\n\n  remove(id) {\n    return this.deleteQuery(`${this.getUrl()}/${id}`)\n  }\n\n  async getQuery(url) {\n    const jwt = token.getToken()\n    const resp = await fetch(url, this.options(jwt))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async postQuery(url, data) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'POST',\n      body: JSON.stringify(data)\n    }))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async putQuery(url, data) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'PUT',\n      body: JSON.stringify(data)\n    }))\n    const response = Rest.afterQuery(resp)\n    return response.json()\n  }\n\n  async deleteQuery(url) {\n    const jwt = token.getToken()\n\n    const resp = await fetch(url, this.options(jwt, {\n      method: 'DELETE'\n    }))\n    const response = Rest.afterQuery(resp)\n    return true\n  }\n\n  static async handleError(response) {\n    const resp = await response.json()\n    throw new Error(resp.message)\n  }\n\n  static afterQuery(response) {\n    if (!response.ok) {\n      return Rest.handleError(response)\n    }\n\n    return response\n  }\n\n  options(token, params = {}) {\n    const headers = {\n      Authorization: `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    }\n\n    return {\n      headers,\n      mode: 'cors',\n      credentials: 'include',\n      ...params\n    }\n  }\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\nimport Rest from './rest'\nimport queryString from 'query-string'\n\nexport default class Chats extends Rest {\n  constructor() {\n    super('api/chats')\n  }\n\n  messages(id, last_message = null) {\n    return this.getQuery(this.getUrl(`/${id}/messages`, queryString.stringify({ last_message })))\n  }\n\n  message(id, message) {\n    return this.postQuery(`${this.getUrl()}/${id}/message`, { message: { message } })\n  }\n}\n","/**\n * Created by vivalaakam on 19.01.2019.\n *\n * @flow\n */\nimport { Socket } from 'phoenix'\nimport token from './token'\n\nexport default class WS {\n  static single = new WS()\n\n  constructor() {\n    this._socket = null\n    this._connections = []\n  }\n\n  connect() {\n    if (!this._socket) {\n      const guardian_token = token.getToken()\n      this._socket = new Socket(`${process.env.PROXY_SERVER.replace(/^http/, 'ws')}/socket`, {\n        params: { guardian_token }\n      })\n    }\n\n    this._socket.connect()\n  }\n\n  disconnect() {\n    if (this._socket) {\n      this._socket.disconnect()\n    }\n  }\n\n  join(name, params = {}) {\n    if (!this._socket) {\n      this.connect()\n    }\n\n    const chan = this._socket.channel(name, params)\n    chan.join()\n\n    this._connections.push(chan)\n\n    return chan\n  }\n\n  leave(chan) {\n    if (this._connections.length) {\n      this._connections = this._connections.filter((curr) => curr !== chan)\n\n      if (!this._connections.length) {\n        this.disconnect()\n      }\n    }\n  }\n}\n","/**\n * Created by vivalaakam on 20.06.2018.\n *\n * @flow\n */\nexport function getCurrentDateTime(date) {\n  var tzoffset = (date).getTimezoneOffset() * 60000 //offset in milliseconds\n  var localISOTime = (new Date(date - tzoffset)).toISOString().slice(0, 19).replace('T', ' ')\n  var mySqlDT = localISOTime\n  return mySqlDT\n}\n","/**\n * Created by vivalaakam on 07.05.2018.\n *\n * @flow\n */\nimport { Socket } from 'phoenix'\nimport { eventChannel } from 'redux-saga'\nimport { createAction } from 'redux-actions'\nimport { cancel, fork, put, select, take, takeLatest } from 'redux-saga/effects'\nimport Chats from '../api/chats'\nimport { getMessages, messagesReset, messagesUpdate } from './messages'\nimport { getCurrentDateTime } from '../utils/date'\nimport WS from '../utils/WS'\n\nconst $$initialState = {\n  loaded: false,\n  loading: false,\n  can_load: true\n}\n\nconst chatsAPI = new Chats()\n\nexport const CHAT_INIT = 'CHAT_INIT'\nexport const CHAT_LOAD = 'CHAT_LOAD'\nexport const CHAT_RESET = 'CHAT_RESET'\nexport const CHAT_UPDATE = 'CHAT_UPDATE'\nexport const CHAT_UNMOUNT = 'CHAT_UNMOUNT'\nexport const CHAT_MESSAGE = 'CHAT_MESSAGE'\n\nexport default function chat($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case CHAT_RESET:\n      return {\n        ...$$initialState,\n        ...payload\n      }\n    case CHAT_UPDATE:\n      return {\n        ...$$state,\n        ...payload\n      }\n    default:\n      return $$state\n  }\n}\n\nexport const chatInit = createAction(CHAT_INIT)\nexport const chatLoad = createAction(CHAT_LOAD)\nexport const chatReset = createAction(CHAT_RESET)\nexport const chatUpdate = createAction(CHAT_UPDATE)\nexport const chatUnmount = createAction(CHAT_UNMOUNT)\nexport const chatMessage = createAction(CHAT_MESSAGE)\n\nexport const getChat = state => state.chat\n\nlet chatSubscription\n\nexport function* onChatInit({ payload }) {\n  try {\n    if (chatSubscription) {\n      yield cancel(chatSubscription)\n    }\n    const resp = yield chatsAPI.fetch(payload)\n    yield put(chatUpdate({ ...resp.data, can_load: resp.data.messages.length === 25 }))\n    yield put(messagesReset(resp.data.messages))\n    chatSubscription = yield fork(chatSubscribe, resp.data.id)\n  } catch (e) {\n    console.log('onChatInit', e.message)\n  }\n}\n\n\nfunction* chatSubscribe(chatId) {\n  let subscription\n  try {\n\n    subscription = eventChannel((emitter) => {\n      const chan = WS.single.join(`chat:${chatId}`, {})\n      chan.on('on_message', emitter)\n\n      return () => {\n        WS.single.leave(chan)\n      }\n    })\n\n    while (true) {\n      const data = yield take(subscription)\n      yield put(messagesUpdate([data]))\n      yield put(chatUpdate({ last_message: data }))\n    }\n\n  } catch (e) {\n    console.log('chatSubscribe', e.message)\n  } finally {\n    if (subscription.close) {\n      subscription.close()\n    }\n  }\n}\n\nfunction* onChatMessage({ payload }) {\n  try {\n    const chat = yield select(getChat)\n    yield chatsAPI.message(chat.id, payload.trim())\n  } catch (e) {\n    console.log('onChatMessage', e.message)\n  }\n}\n\nfunction* onChatLoad() {\n  try {\n    yield put(chatUpdate({ loading: true }))\n    const chat = yield select(getChat)\n    const msgs = yield select(getMessages)\n    const last = msgs[0]\n    const messages = yield chatsAPI.messages(chat.id, getCurrentDateTime(last.inserted_at))\n    yield put(chatUpdate({ loading: false, can_load: messages.data.length === 25, loaded: true }))\n    yield put(messagesUpdate(messages.data))\n  } catch (e) {\n    console.log('onChatLoad', e.message)\n  }\n}\n\nfunction* onChatUnmount() {\n  try {\n    yield put(chatReset({}))\n    yield put(messagesReset([]))\n    if (chatSubscription) {\n      yield cancel(chatSubscription)\n    }\n  } catch (e) {\n    console.log('onChatUnmount', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, CHAT_INIT, onChatInit)\n  yield fork(takeLatest, CHAT_LOAD, onChatLoad)\n  yield fork(takeLatest, CHAT_UNMOUNT, onChatUnmount)\n  yield fork(takeLatest, CHAT_MESSAGE, onChatMessage)\n}\n","/**\n * Created by vivalaakam on 04.05.2018.\n *\n * @flow\n */\nimport queryString from 'query-string';\nimport Rest from './rest';\n\nexport default class Users extends Rest {\n  constructor() {\n    super('api/users');\n  }\n\n  update(data) {\n    return this.postQuery(this.getUrl(), data);\n  }\n\n  fetch(full = false) {\n    return this.getQuery(this.getUrl('', queryString.stringify({ full })));\n  }\n\n  list(users = []) {\n    const string = queryString.stringify({ users }, { arrayFormat: 'bracket' });\n    return this.getQuery(this.getUrl('/list', string));\n  }\n}\n","/**\n * Created by vivalaakam on 08.05.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\nimport { push } from 'connected-react-router'\nimport { fork, put, select, takeLatest } from 'redux-saga/effects'\nimport Users from '../api/users'\nimport { getUser } from './user'\nimport Chats from '../api/chats'\nimport { chatsUpdate } from './chats'\n\nconst userApi = new Users()\nconst chatApi = new Chats()\nconst $$initialState = []\n\nexport const USERS_UPDATE = 'USERS_UPDATE'\nexport const USERS_FETCH = 'USERS_FETCH'\nexport const USERS_RESET = 'USERS_RESET'\nexport const USERS_PRIVATE_CHAT = 'USERS_PRIVATE_CHAT'\nexport const USERS_INIT = 'USERS_INIT'\n\nexport default function user($$state = $$initialState, { type, payload }) {\n  switch (type) {\n    case USERS_RESET:\n      return payload\n    case USERS_UPDATE:\n      return $$state.concat(payload)\n    default:\n      return $$state\n  }\n}\n\nexport const usersUpdate = createAction(USERS_UPDATE)\nexport const usersReset = createAction(USERS_RESET)\nexport const usersFetch = createAction(USERS_FETCH)\nexport const usersPrivateChat = createAction(USERS_PRIVATE_CHAT)\n\nexport function* onUsersInit() {\n  try {\n    const user = yield select(getUser)\n    const users = yield userApi.all()\n    const data = users.data.filter((u) => (u.id !== user.id))\n    yield put(usersReset(data))\n  } catch (e) {\n    console.log('onUsersInit', e.message)\n  }\n}\n\nfunction* onUsersPrivateChat({ payload }) {\n  try {\n    const user = yield select(getUser)\n    const chat = yield chatApi.create({ chat: { name: 'private', is_private: true, users: [payload.id, user.id] } })\n    yield put(push(`/chats/${chat.data.id}`))\n\n    yield put(chatsUpdate({\n      ...chat.data,\n      last: new Date()\n    }))\n  } catch (e) {\n    console.log('onUsersPrivateChat', e.message)\n  }\n}\n\nexport function* watcher() {\n  yield fork(takeLatest, USERS_PRIVATE_CHAT, onUsersPrivateChat)\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Btn\":\"Btn_Btn___6Qbu\",\"defaultScheme\":\"Btn_defaultScheme__2FZxQ\",\"active\":\"Btn_active__1sQMl\",\"inverted\":\"Btn_inverted__3hx0f\",\"blueScheme\":\"Btn_blueScheme__1HpUY\",\"greenScheme\":\"Btn_greenScheme__2wwnR\",\"orangeScheme\":\"Btn_orangeScheme__eglMg\",\"githubScheme\":\"Btn_githubScheme__3P5DQ\",\"googleScheme\":\"Btn_googleScheme__gelXl\",\"facebookScheme\":\"Btn_facebookScheme__3T4xQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Modal\":\"Modal_Modal__2Ff3a\",\"wrapper\":\"Modal_wrapper__17Z-7\"};","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport classnames from 'classnames'\nimport style from './Btn.scss'\n\nexport default function Btn({ children, className, onClick, name, active, inverted, disabled, scheme }) {\n  const cName = classnames(style.Btn, style[`${scheme}Scheme`], className, {\n    [style.active]: active,\n    [style.inverted]: inverted\n  })\n  return (\n    <button className={cName} {...{ name, disabled, onClick }}>{children}</button>\n  )\n}\n\nBtn.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.element\n  ]).isRequired,\n  name: PropTypes.string,\n  className: PropTypes.string,\n  onClick: PropTypes.func.isRequired,\n  active: PropTypes.bool,\n  disabled: PropTypes.bool,\n  inverted: PropTypes.bool,\n  scheme: PropTypes.oneOf(['default', 'green', 'blue', 'orange', 'github', 'google', 'facebook'])\n}\n\nBtn.defaultProps = {\n  scheme: 'default',\n  name: '',\n  className: '',\n  disabled: false,\n  inverted: false,\n  active: false\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport createHistory from 'history/createBrowserHistory'\nimport { hasWindow } from './helpers'\n\nexport default hasWindow && createHistory()\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nexport const hasWindow = typeof window !== 'undefined'\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\nimport { Provider } from 'react-redux'\nimport { ConnectedRouter } from 'connected-react-router'\nimport history from './utils/history'\n\nexport default function Wrapper({ store, children }) {\n  if (history) {\n    return (\n      <Provider store={store}>\n        <ConnectedRouter history={history}>\n          {children}\n        </ConnectedRouter>\n      </Provider>\n    )\n  }\n\n  return (\n    <Provider store={store}>\n      {children}\n    </Provider>\n  )\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React from 'react'\n\nconst Loading = () => (\n  <div>Loading</div>\n)\n\nexport default Loading\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { createAction } from 'redux-actions'\n\nconst UPDATE_STATE = 'UPDATE_STATE'\n\nexport default function outer(reducer) {\n  return function outerReducer(state, action) {\n    switch (action.type) {\n      case UPDATE_STATE:\n        return reducer({ ...state, ...action.payload }, action)\n      default:\n        return reducer(state, action)\n    }\n  }\n}\n\nexport const updateState = createAction(UPDATE_STATE)\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { all, call, fork } from 'redux-saga/effects'\nimport { router } from 'redux-saga-router'\nimport history from '../utils/history'\n\nimport { onChatInit, watcher as chatWatcher } from './chat'\nimport { watcher as userWatcher } from './user'\nimport { watcher as chatsWatcher } from './chats'\nimport { onUsersInit, watcher as usersWatcher } from './users'\n\nconst routes = {\n  * '/chats'() {\n    yield call(onUsersInit)\n  },\n  * '/chats/:chatId'({ chatId }) {\n    yield call(onChatInit, { payload: chatId })\n  }\n}\n\nexport default function* rootSaga() {\n  const sagas = [\n    chatWatcher(),\n    userWatcher(),\n    chatsWatcher(),\n    usersWatcher()\n  ]\n\n  if (history) {\n    sagas.unshift(router(history, routes))\n  }\n\n  yield fork(all, sagas)\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { applyMiddleware, compose, createStore } from 'redux'\nimport thunk from 'redux-thunk'\nimport createSagaMiddleware from 'redux-saga'\nimport { updateState } from '../reducers/outer'\nimport createReducers from './index'\nimport { hasWindow } from '../utils/helpers'\nimport history from '../utils/history'\nimport sagas from './sagas'\nimport persistState from 'redux-localstorage'\n\nconst sagaMiddleware = createSagaMiddleware()\n\n\nconst middleware = [\n  thunk,\n  sagaMiddleware,\n]\n\nif (process.env.NODE_ENV === 'development' && hasWindow) {\n  const { createLogger } = require('redux-logger')\n\n  const logger = createLogger({\n    actionTransformer: action => ({\n      ...action,\n      type: String(action.type)\n    })\n  })\n\n\n  middleware.push(logger)\n}\n\nexport default function configureStore(initialState) {\n  const middle = [...middleware]\n  if (history) {\n    const router = require('connected-react-router')\n    middle.push(router.routerMiddleware(history))\n  }\n\n  const composeEnhancers = (window && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose\n\n  const store = createStore(\n    createReducers(history),\n    {},\n    composeEnhancers(applyMiddleware(...middle), persistState(['user']))\n  )\n\n  store.updateState = (state) => {\n    const keys = Object.keys(store.getState())\n    const filtered = keys.reduce((st, key) => {\n      if (Object.prototype.hasOwnProperty.call(state, key)) {\n        st[key] = state[key]\n      }\n      return st\n    }, {})\n\n    return store.dispatch(updateState(filtered))\n  }\n  store.runSaga = sagaMiddleware.run\n  store.asyncReducers = {}\n\n  store.updateState(initialState)\n\n  /* istanbul ignore next */\n  if (module.hot) {\n    module.hot.accept('./index', () => {\n      import('./index').then((reducerModule) => {\n        const createReducersLoaded = reducerModule.default\n        const nextReducers = createReducersLoaded({ ...store.asyncReducers })\n\n        store.replaceReducer(nextReducers)\n      })\n    })\n  }\n\n  sagaMiddleware.run(sagas)\n\n  return store\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React, { PureComponent } from 'react'\nimport ReactDOM from 'react-dom'\nimport classnames from 'classnames'\nimport styles from './Modal.scss'\n\nconst modalRoot = document.getElementById('modal')\n\nexport default class Modal extends PureComponent {\n  constructor(props) {\n    super(props)\n    this.el = document.createElement('div')\n  }\n\n  componentDidMount() {\n    // The portal element is inserted in the DOM tree after\n    // the Modal's children are mounted, meaning that children\n    // will be mounted on a detached DOM node. If a child\n    // component requires to be attached to the DOM tree\n    // immediately when mounted, for example to measure a\n    // DOM node, or uses 'autoFocus' in a descendant, add\n    // state to Modal and only render the children when Modal\n    // is inserted in the DOM tree.\n    modalRoot.appendChild(this.el)\n  }\n\n  componentWillUnmount() {\n    modalRoot.removeChild(this.el)\n  }\n\n  render() {\n    return ReactDOM.createPortal(\n      this.renderWrapper(),\n      this.el\n    )\n  }\n\n  renderWrapper() {\n    const style = classnames(styles.wrapper, this.props.className)\n    return (\n      <div className={styles.Modal}>\n        <div className={style}>\n          {this.props.children}\n        </div>\n      </div>\n    )\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\nimport React, { PureComponent } from 'react'\nimport Modal from '../Modal/Modal'\n\nimport styles from './Auth.scss'\nimport Btn from '../UI/Btn/Btn'\nimport loginPopup from '../../utils/loginPopup'\n\nexport default class Auth extends PureComponent {\n  render() {\n    return (\n      <Modal className={styles.Auth}>\n        <Btn onClick={this.onClickLogin}>\n          Login\n        </Btn>\n      </Modal>\n    )\n  }\n\n  onClickLogin = (e) => {\n    if (e) {\n      e.preventDefault()\n    }\n    loginPopup('identity')\n      .then((data) => {\n        this.props.applyAuth(data)\n      })\n      .catch((error) => {\n        /* eslint no-console: [\"error\", { allow: [\"log\"] }] */\n        console.log(error.message)\n      })\n  }\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nexport default function loginPopup(provider) {\n  return new Promise((resolve) => {\n    let win\n    const curWidth = document.body.offsetWidth\n    const curLeft = window.screenLeft\n    const leftPos = curLeft + (curWidth / 2) - 500\n\n    const curTop = window.screenTop\n    const topPos = curTop + 100\n\n    function receiveMessage(result) {\n      if (result.data.id) {\n        resolve(result.data)\n        win.close()\n      }\n    }\n\n    window.addEventListener('message', receiveMessage, false)\n    const features = `status=no,scrollbar=yes,resizable=yes,width=1000,height=800,top=${topPos},left=${leftPos}`\n    console.log(`${process.env.PROXY_SERVER}/auth/${provider}`);\n    win = window.open(`${process.env.PROXY_SERVER}/auth/${provider}`, 'auth_popup', features)\n  })\n}\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\nimport { connect } from 'react-redux'\n\nimport AuthComponent from '../Components/Auth/Auth'\nimport { userApply } from '../reducers/user'\n\nconst mapStateToProps = state => ({\n  user: state.user\n})\n\nconst mapDispathToProps = dispatch => ({\n  applyAuth(data) {\n    dispatch(userApply(data))\n  }\n})\n\nclass Auth extends PureComponent {\n  render() {\n    if (this.props.user.id) {\n      return null\n    }\n\n    return (\n      <AuthComponent applyAuth={this.props.applyAuth} />\n    )\n  }\n}\n\nexport default connect(mapStateToProps, mapDispathToProps)(Auth)\n","/**\n * Created by vivalaakam on 18.01.2019.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\nimport { Redirect } from 'react-router-dom'\n\nclass HomeContainer extends PureComponent {\n  render() {\n    return (\n      <Redirect to=\"/chats\" />\n    )\n  }\n}\n\n\nexport default HomeContainer\n","/**\n * Created by vivalaakam on 18.01.2019.\n *\n * @flow\n */\n\nimport React, { PureComponent } from 'react'\n\nclass TermsContainer extends PureComponent {\n  render() {\n    return (\n      <p>Используйте приложение на свой страх и риск</p>\n    )\n  }\n}\n\n\nexport default TermsContainer\n","import React, { Component } from 'react'\nimport { Route, Switch } from 'react-router-dom'\nimport Loadable from 'react-loadable'\n\nimport Wrapper from './Wrapper'\nimport Loading from './Loading'\nimport configureStore from './reducers/store'\nimport Auth from './Containers/Auth'\nimport Home from './Containers/Home'\nimport Terms from './Containers/Terms'\n\nexport function loadableFactory(loader) {\n  return Loadable({\n    loader,\n    loading: Loading,\n    render(loaded, props) {\n      const Comp = loaded.default\n      return <Comp {...props} />\n    }\n  })\n}\n\nconst Chats = loadableFactory(() => import('./Containers/Chats'))\n\nconst userStore = configureStore(window.__INITIAL_STATE__ || {})\n\nclass App extends Component {\n  render() {\n    return (\n      <Wrapper store={userStore}>\n        <div id=\"inner\">\n          <Auth />\n          <Switch>\n            <Route exact path=\"/\" component={Home} />\n            <Route path=\"/chats\" component={Chats} />\n            <Route path=\"/terms\" component={Terms} />\n          </Switch>\n        </div>\n      </Wrapper>\n    )\n  }\n}\n\nexport default App\n","/**\n * Created by vivalaakam on 19.06.2018.\n *\n * @flow\n */\n\nimport { combineReducers } from 'redux'\nimport { connectRouter } from 'connected-react-router'\n\n\nimport messages from './messages'\nimport outer from './outer'\nimport users from './users'\nimport chats from './chats'\nimport user from './user'\nimport chat from './chat'\n\nexport default function reducers(history, ext = {}) {\n  return outer(combineReducers({ router: connectRouter(history), user, chat, chats, users, outer, messages, ...ext }))\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Auth\":\"Auth_Auth__2lPSo\"};"],"sourceRoot":""}